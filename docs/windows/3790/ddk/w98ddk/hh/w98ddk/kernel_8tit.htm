<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>I/O Trapping</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT></HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Windows&nbsp;98/Me:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="_pss_1195"></A>I/O Trapping</H1>

<P>The VMM provides the <B>Install_IO_Handler</B> service to install a callback procedure to handle protection faults for a given port. When a virtual device calls <B>Install_IO_Handler</B>, the VMM sets the appropriate bit in the I/O permission map (IOPM) and registers the procedure. When a virtual machine executes an instruction that reads or writes data from an I/O port, the 80386 looks up the port number in the I/O permission map. If the corresponding bit in the IOPM is set, then the instruction will cause a protection fault that results in calling the registered procedure. </P>

<P>There are the following I/O services: </P>

<TABLE>

<TR VALIGN="top">
<TH align=left width=33%>Service </TH>
<TH align=left width=67%>Description </TH>
</TR>

<TR VALIGN="top">
<TD width=33%><B>Disable_Global_Trapping</B></TD>
<TD width=67%>Disables global I/O trapping (I/O works directly with hardware and is not intercepted). </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>Disable_Local_Trapping</B></TD>
<TD width=67%>Disables local I/O trapping (I/O works directly with hardware and is not intercepted). </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>Enable_Global_Trapping</B></TD>
<TD width=67%>Enables global I/O trapping (I/O requests are trapped instead of working directly with hardware).  Enabled by default at system startup. </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>Enable_Local_Trapping</B></TD>
<TD width=67%>Enables local I/O trapping (I/O requests are trapped instead of working directly with hardware).</TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>Install_IO_Handler</B></TD>
<TD width=67%>Install an I/O callback procedure. </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>Install_Mult_IO_Handlers</B></TD>
<TD width=67%>Install I/O handlers for multiple ports. </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>Remove_IO_Handler</B></TD>
<TD width=67%>Removes the I/O handler for the specified port and disables trapping for that port. </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>Remove_Mult_IO_Handlers</B></TD>
<TD width=67%>Repeatedly calls the <B>Remove_IO_Handler</B> service for each entry in the VxD_IO_Table, removing the specified IO handlers. </TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>Simulate_IO</B></TD>
<TD width=67%>Reduces complex I/O instructions to simpler I/O operations.</TD>
</TR>

<TR VALIGN="top">
<TD width=33%><B>_Simulate_VM_IO</B></TD>
<TD width=67%>Simulate ring 3 port I/O from the current vm (inside a ring 0 VxD).  </TD>
</TR>
</TABLE><BR>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: I%2FO%20Trapping"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
