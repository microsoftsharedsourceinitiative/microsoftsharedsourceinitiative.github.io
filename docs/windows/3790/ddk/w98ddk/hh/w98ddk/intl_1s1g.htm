<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>COMPOSITIONFORM</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT></HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Windows&nbsp;98/Me:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="_pss_924"></A>COMPOSITIONFORM</H1>

<PRE>typedef tagCOMPOSITIONFORM {
    DWORD  dwStyle;
    POINT  ptCurrentPos;
    RECT  rcArea;
}COMPOSITIONFORM;
 </PRE>

<P>The <B>dwStyle</B> member is specified by CFS_xxxx. The <B>ptCurrentPos</B> member specifies the size and position of the bounding rectangle and the start position of the composition window. </P>

<P><B>CFS_DEFAULT</B> </P>

<P>The CFS_DEFAULT value moves the composition window out to the default position. The IME can display the composition window outside the client area. It might be on a floating window. </P>

<P><IMG SRC="images/ime_01.gif" ALT="" BORDER=0></P>

<P><B>CFS_POINT</B> </P>

<P>The CFS_POINT value displays the composition window at the upper left of the latter window, at the position indicated by <B>ptCurrentPos</B>. The <B>ptCurrentPos</B> member indicates the coordinates relative to the upper left of the latter window, with the low-order word representing the x coordinate and the high-order word the y coordinate. </P>

<P><IMG SRC="images/ime_02.gif" ALT="" BORDER=0></P>

<P><B>CFS__FORCE_POSITION</B> </P>

<P>The CFS_FORCE_POSITION value displays the composition window at the upper left of the window as designated by <B>ptCurrentPos</B>. The <B>ptCurrentPos</B> member indicates the coordinates relative to the upper left of the latter window, with the low-order word representing the x coordinate and the high-order word the y coordinate. </P>

<P>Some near caret operation IMEs show its conversion window by adjusting the position specified by the system or the application. The CFS_FORCE_POSITION informs IMEs to stop this adjustment. </P>

<P><IMG SRC="images/ime_03.gif" ALT="" BORDER=0></P>

<P>If the CFS_FORCE_POSITION bit is off, some IMEs adjust their position according to the position specified in <B>ptCurrentPos</B> with CFS_POINT style. </P>

<P><IMG SRC="images/ime_04.gif" ALT="" BORDER=0></P>

<P><B>CFS_RECT</B> </P>

<P>The CFS_RECT value is the same as CFS_POINT except that the bounding rectangle is specified by <B>rcCompArea</B>. The coordinates are relative to the upper left of the window. </P>

<P><IMG SRC="images/ime_05.gif" ALT="" BORDER=0></P>

<P>When the style of the <B>COMPOSITIONFORM</B> structure is CFS_POINT or CFS_FORCE_POINT, the IME starts to draw the composition string from the position that is specified by <B>ptCurrentPos</B> of the <B>COMPOSITIONFORM</B> structure that is given by the application. If the style has CFS_RECT, the composition string will be inside of the rectangle that is specified by <B>rcArea</B>. If not, <B>rcArea</B> is the client rectangle of the application window. </P>

<P>When the application specifies the composition font, the composition window is rotated as the escapement of the composition font. The direction of the composition string follows the escapement of the font in a composition window. IME starts to draw the composition string as follows. </P>

<P>The escapement of the composition font is zero </P>

<P><IMG SRC="images/ime_06.gif" ALT="" BORDER=0></P>

<P>This is the typical  case. The <B>ptCurrentPos</B> member of the composition form structure points to the left and top of the string. All IMEs support this type. </P>

<P>The escapement of the composition font is 2700. </P>

<P><IMG SRC="images/ime_07.gif" ALT="" BORDER=0></P>

<P>This is a case of a vertical writing. When the application provides the vertical writing, the application may set the 2700 escapement in the composition font that is set by <B>ImmCompositionFont</B>. The composition string will be drawn downward. The IMEs that have UI_CAP_2700, UI_CAP_ROT90 or UI_CAP_ROTANY capability support this type of the composition window. </P>

<P>The escapement of the composition font is 900 or 1800 </P>

<P><IMG SRC="images/ime_08.gif" ALT="" BORDER=0></P>

<P><IMG SRC="images/ime_09.gif" ALT="" BORDER=0></P>

<P>The IMEs that have UI_CAP_ROT90 or UI_CAP_ROTANY capability support this type of \composition window. </P>

<P>The escapement of the composition font is any value. </P>

<P><IMG SRC="images/ime_10.gif" ALT="" BORDER=0></P>

<P>The IMEs that have UI_CAP_ROTANY capability support this type of the composition window. </P>

<P>UI_CAP_ROT90 and UI_CAPS_ANY are the options for the enhancement of the IME. UI_CAP_2700 is recommended. </P>

<P>This structure is used with the IMC_SETCOMPOSITIONWINDOW and IMC_SETCANDIDATEPOS messages. </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: COMPOSITIONFORM"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
