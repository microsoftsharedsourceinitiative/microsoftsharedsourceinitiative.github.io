<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>UDP-ESP Encapsulation Types</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="UDP-ESP Encapsulation Types">
</HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Network&nbsp;Devices&nbsp;and&nbsp;Protocols:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H3><A NAME="ddk_udp_esp_encapsulation_types_ng"></A>UDP-ESP Encapsulation Types</H3>

<P>The following figure shows the UDP encapsulation of Internet Key Exchange (IKE) packets and ESP-protected data packets that are received on port 4500.</P>

<P><IMG SRC="images/4500_encap_types.gif" ALT="" BORDER=0></P>

<P><B>Basic UDP-ESP Encapsulation for Port 4500</B></P>

<P>Note the four bytes of zeros that follow the UDP header in IKE packets. This field of zeros differentiates IKE packets from UDP-encapsulated ESP packets on port 4500. Instead of zeros, ESP headers have a nonzero ESP header at this location in the packet.</P>

<H4>UDP-ESP Encapsulation Subtypes</H4>

<P>ESP packets on port 4500 can be formatted according to one of the following UDP-ESP encapsulation subtypes:

<UL>
	<LI>UDP-encapsulated transport.
<P>An ESP-encapsulated transport-mode packet is encapsulated by UDP.
</LI>

	<LI>UDP-encapsulated tunnel.
<P>The tunnel-mode portion of a packet is UDP-encapsulated. The transport-mode portion of the packet is not UDP-encapsulated and is not ESP-protected.
</LI>

	<LI>Transport over UDP-encapsulated tunnel.
<P>The tunnel-mode portion of a packet is UDP-encapsulated. The transport-mode portion of a packet is not UDP-encapsulated, but is ESP-protected.
</LI>

	<LI>UDP-encapsulated transport over tunnel.
<P>The tunnel-mode portion of a packet is not UDP-encapsulated. The transport-mode portion of a packet is UDP-encapsulated and ESP-protected.
</LI>
</UL>

<P>Note that a UDP-encapsulated transport over a UDP-encapsulated tunnel is not a supported encapsulation subtype.</P>

<P>The following figure shows the UDP-ESP encapsulation subtypes for port 4500.</P>

<P><IMG SRC="images/4500_encap_subtypes.gif" ALT="" BORDER=0></P>

<P><B>UDP-ESP Encapsulation Subtypes for Port 4500</B></P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: UDP-ESP%20Encapsulation%20Types"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
