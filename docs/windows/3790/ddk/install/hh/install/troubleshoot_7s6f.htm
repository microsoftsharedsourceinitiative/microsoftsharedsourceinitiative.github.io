<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Setting SetupAPI Logging Levels</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="Setting SetupAPI Logging Levels">
</HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Device&nbsp;Installation:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H2><A NAME="ddk_setting_setupapi_logging_levels_dg"></A>Setting SetupAPI Logging Levels</H2>

<P>You can control the amount of information that is written to the SetupAPI log, either for all Setup applications or for individual Setup applications.</P>

<P>To change the level of information written to the SetupAPI log for all Setup applications, create (or modify) the following registry value:</P>

<PRE>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Setup\LogLevel
</PRE>

<P>By setting this value (using the values listed in the tables below) you can choose the level of errors that are logged, modify the verbosity of logging, or turn off logging. You can also log information to a debugger as well as to the log file.</P>

<P>To specify logging levels for individual Setup applications, create a registry entry under the following key:</P>

<PRE>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Setup\AppLogLevels
</PRE>

<P>Under this key, create a value name representing the application's executable file name, and assign the desired logging level to that name (using the values listed in the tables below), such as <B>service.exe=</B><I>LoggingLevel</I>.</P>

<P>The logging level is a DWORD value. If this value is not specified or is zero, SetupAPI uses a default behavior, as indicated in the tables below.</P>

<P>The DWORD value is made up of three parts, formatted as 0x<I>SSSSDDGG</I>. The low eight bits, represented by the mask 0x000000FF, set the logging level for general Setup operations. The next-higher eight bits, represented by the mask 0x0000FF00, set the logging level for device installation operations. The highest bits are special flags. </P>

<P>The following tables contain the general logging levels, device installation logging levels, and special logging flags for Windows 2000 and later.</P>

<TABLE>

<TR VALIGN="top">
<TH align=left width=28%>General Logging Levels</TH>
<TH align=left width=72%>Meaning</TH>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000000</TD>
<TD width=72%>Use default settings (currently 0x20).</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000001</TD>
<TD width=72%>Off (no Setup logging).</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000010</TD>
<TD width=72%>Log errors.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000020</TD>
<TD width=72%>Log errors and warnings.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000030</TD>
<TD width=72%>Log errors, warnings and other information.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000040</TD>
<TD width=72%>Log errors, warnings and other information in verbose mode.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000050</TD>
<TD width=72%>Log errors, warnings and other information in verbose mode, plus time-stamped entries.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000060</TD>
<TD width=72%>Log errors, warnings and other information in verbose mode, plus time entries. Additionally, all entries are time-stamped.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000070</TD>
<TD width=72%>Log errors, warnings and other information in verbose mode, plus time messages. All entries are time-stamped. Additional messages that can slow down the system, such as cache hits, are included.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x000000FF</TD>
<TD width=72%>Specifies the most verbose logging available.</TD>
</TR>
</TABLE><BR>

<TABLE>

<TR VALIGN="top">
<TH align=left width=28%>Device Logging Levels</TH>
<TH align=left width=72%>Meaning</TH>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000000</TD>
<TD width=72%>Use default settings (currently 0x3000).</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00000100</TD>
<TD width=72%>Off (no Setup logging).</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00001000</TD>
<TD width=72%>Log errors.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00002000</TD>
<TD width=72%>Log errors and warnings.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00003000</TD>
<TD width=72%>Log errors, warnings and other information.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00004000</TD>
<TD width=72%>Log errors, warnings and other information in verbose mode.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00005000</TD>
<TD width=72%>Log errors, warnings and other information in verbose mode, plus time-stamped entries.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00006000</TD>
<TD width=72%>Log errors, warnings and other information in verbose mode, plus time entries. Additionally, all entries are time-stamped.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x00007000</TD>
<TD width=72%>Log errors, warnings and other information in verbose mode, plus time messages. All entries are time-stamped. Additional messages that can slow down the system, such as cache hits, are included.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x0000FF00</TD>
<TD width=72%>Specifies the most verbose logging available.</TD>
</TR>
</TABLE><BR>

<TABLE>

<TR VALIGN="top">
<TH align=left width=28%>Special Flags</TH>
<TH align=left width=72%>Meaning</TH>
</TR>

<TR VALIGN="top">
<TD width=28%>0x08000000</TD>
<TD width=72%>(<I>Windows XP and later</I>) Add a time stamp to all log entries.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x20000000</TD>
<TD width=72%>(<I>Windows XP and later</I>) Don't flush logging information to disk after each entry is written. (Logging is faster, but information could be lost if the system crashes.)</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x40000000</TD>
<TD width=72%>Write log entries chronologically instead of grouping entries.</TD>
</TR>

<TR VALIGN="top">
<TD width=28%>0x80000000</TD>
<TD width=72%>Send the output to the debugger as well as to the log file.</TD>
</TR>
</TABLE><BR>

<P>For example, SetupAPI interprets some sample <I>LoggingFlags</I> values as follows:

<DL>
<DT>&nbsp;&nbsp;&nbsp;&nbsp;0x00000000 means default logging</DT>

<DT>&nbsp;&nbsp;&nbsp;&nbsp;0x0000FFFF means verbose logging</DT>

<DT>&nbsp;&nbsp;&nbsp;&nbsp;0x8000FF00 means log verbose device installation information <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to both the log file and the debugger</DT>

<DT>&nbsp;&nbsp;</DT>

<DD></DD>
</DL>

<P>To modify the default SetupAPI logging levels during a clean installation, edit the registry during the period between text-mode Setup and GUI-mode Setup. The following steps describe the procedure. These steps assume that you are installing to <I>D:\Winnt</I> and have a working build of the same version of Windows on another partition. Change the SetupAPI logging levels as follows:

<OL>
	<LI>Start the installation of the clean build you are testing.</LI>

	<LI>Stop the setup process during the first boot after text-mode Setup (that is, before GUI-mode Setup). </LI>

	<LI>Boot into the working build by selecting it from the boot menu, and log on as Administrator. </LI>

	<LI>Find the registry hives (files) in <I>D:\Winnt\System32\config</I>. In this case, you need to modify the registry hive in <I>Software.sav</I>. </LI>

	<LI>On Windows 2000, run <I>Regedt32</I>, select the "HKEY_LOCAL_MACHINE on Local Machine" window, and select the HKEY_LOCAL_MACHINE key. Then click on the <B>Registry</B> menu and select <B>Load Hive</B>. 
<P>On Windows XP and later, run <I>RegEdit</I>. Highlight HKEY_LOCAL_MACHINE, click on the <B>File</B> menu and select <B>Load Hive</B>.
</LI>

	<LI>Browse the files and select <I>D:\Winnt\System32\config\software.sav</I>. When prompted for key name, enter "_sw.sav " </LI>

	<LI>Open the _sw.sav key under HKEY_LOCAL_MACHINE and highlight the following key: 
<PRE>HKEY_LOCAL_MACHINE\_sw.sav\Microsoft\Windows\CurrentVersion\Setup</PRE>

<P>On Windows 2000, click on the <B>Security</B> menu, select <B>Permissions</B>, and grant full control to Administrator. 

<P>On Windows XP and later, click on the <B>Edit</B> menu, select <B>Permissions</B>, and grant full control to Administrator.
</LI>

	<LI>On Windows 2000, add the necessary registry values under this key using clicking on <B>Edit</B> and selecting <B>Add Value</B>.
<P>On Windows XP and later, click on <B>Edit</B> and select <B>New DWORD Value</B>.

<P>Enter the value. For example, add "0xFFFF" to enable full verbose logging. 
</LI>

	<LI>Select HKEY_LOCAL_MACHINE\_sw.sav, and unload the hive (using the <B>Registry</B> menu on Windows 2000, or the <B>File</B> menu on Windows XP and later)The _sw.sav key should disappear. </LI>

	<LI>Copy <I>D:\Winnt\System32\config\software.sav</I> to <I>D:\Winnt\System32\config\software</I>. </LI>

	<LI>Reboot and continue into Setup. </LI>

	<LI>To verify this change, press SHIFT+F10 in GUI-mode Setup, then run <I>regedit.exe</I> and check the logging level.</LI>
</OL>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Setting%20SetupAPI%20Logging%20Levels"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
