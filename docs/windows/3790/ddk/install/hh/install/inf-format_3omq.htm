<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>INF AddInterface Directive</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="INF AddInterface Directive">
</HEAD>
<BODY TOPMARGIN="0">
<DIV STYLE="display:none;">
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_using_guids_in_drivers_kg">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_iosetdeviceinterfacestate_kr">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ioregisterdeviceinterface_kr">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_adddevice_kr">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ioregisterdeviceinterface_kr">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_iosetdeviceinterfacestate_kr">
</OBJECT>
</DIV>


<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Device&nbsp;Installation:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="ddk_inf_addinterface_directive_dr"></A>INF AddInterface Directive</H1>

<P><B>[</B><I>DDInstall</I><B>.Interfaces]<BR>
&nbsp;</B> <BR>
<B>AddInterface={</B><I>InterfaceClassGUID</I><B>}</B> [<B>, </B>[<I>reference&nbsp;string</I>] [<B>,</B>[<I>add-interface-section</I>]  [<B>,</B>flags]]] <BR>
<B>&nbsp;</B> <BR>
<B>&nbsp;</B> <BR>
</P>

<P>One or more <B>AddInterface</B> directives can be specified within an <A HREF="inf-format_4eeq.htm">INF <I>DDInstall</I>.<B>Interfaces</B> section</A>. This directive installs device-specific support for <A HREF="setup-cls_54kn.htm">device interface classes</A> exported to higher level components, such as other drivers or applications. The directive typically references an <I>add-interface-section</I> , which sets up registry information for the device-specific instance of the device interface class. </P>

<P>An exported device interface class can be one of the system-defined device interface classes, such as those defined by kernel streaming, or a new device interface class specified by an <A HREF="inf-format_3o8i.htm">INF <B>InterfaceInstall32</B> section</A>.</P>

<H4>Entry Values</H4>

<DL>
<DT><I>InterfaceClassGUID</I></DT>

<DD>Specifies the GUID value that identifies the device interface class. This can be expressed as an explicit GUID value of the form <B>{</B><I>nnnnnnnn</I><B>-</B><I>nnnn</I><B>-</B><I>nnnn</I>-<I>nnnn</I><B>-</B><I>nnnnnnnnnnnn</I><B>}</B> or as a <B>%</B><I>strkey</I><B>%</B> token defined to <B>"{</B><I>nnnnnnnn</I><B>-</B><I>nnnn</I><B>-</B><I>nnnn</I>-<I>nnnn</I><B>-</B><I>nnnnnnnnnnnn</I><B>}"</B> in a <B>Strings</B> section of the INF file. 

<P>For more information about how to create a GUID, see <A HREF="JavaScript:hhobj_1.Click()">Using GUIDs in Drivers</A>. For the system-defined interface class GUIDS, see the appropriate header, such as <I>ks.h</I> for the kernel-streaming interface GUIDs. 
</DD>

<DT><I>reference&nbsp;string</I> </DT>

<DD>This optional value, associated with the device-specific instance of the specified interface class, can be expressed either as a <B>"</B><I>quoted string</I><B>"</B> or as a <B>%</B><I>strkey</I><B>%</B> token defined in an <A HREF="inf-format_3uuq.htm">INF <B>Strings</B> section</A>. 

<P>PnP function and filter drivers usually omit this value from the <B>AddInterface=</B> entries in their INF files.A <I>reference&nbsp;string</I> is used by the <I>swenum</I> driver, as a placeholder for software devices that are created on demand, using multiple instances of a single interface class. The same <I>InterfaceClassGUID</I> value can be specified in INF entries with two or more unique <I>reference&nbsp;string</I>s. Because the I/O Manager passes the <I>reference&nbsp;string</I> value as a path component of the interface instance's name whenever it is opened, the installed driver can discriminate between interface instances of the same class for a single device. 
</DD>

<DT><I>add-interface-section</I></DT>

<DD>References the name of a section elsewhere in the INF file, which typically contains an <A HREF="inf-format_2v02.htm">INF <B>AddReg</B> directive</A> to set up the registry entries exporting the driver's support of this device interface class. For more information, see the following Comments section.</DD>

<DT><I>flags</I></DT>

<DD>If specified, must be zero.
</DD>
</DL>

<H4>Comments</H4>

<P>If the device interface class identified by a given <B>{</B><I>InterfaceClassGUID</I><B>}</B> is not installed already, the system setup code installs that class in the system. Any INF file that installs a new class also has an <A HREF="inf-format_3o8i.htm">INF <B>InterfaceInstall32</B> section</A> containing the specified <B>{</B><I>InterfaceClassGUID</I><B>}</B> and referencing an <I>interface-install-section</I> that sets up interface-specific installation operations for that class.</P>

<P>To enable an instance of a device interface class for runtime use by higher level components, the driver must make a call <A HREF="JavaScript:hhobj_2.Click()"><B>IoSetDeviceInterfaceState</B></A> with each <B>{</B><I>InterfaceClassGUID</I><B>}</B> value identifying a device interface class that the driver supports on the underlying device. As an alternative to registering its support for a device interface class in its INF, a device driver can call <A HREF="JavaScript:hhobj_3.Click()"><B>IoRegisterDeviceInterface</B></A> before making its initial call to <B>IoSetDeviceInterfaceState</B>. Usually, a PnP function or filter driver makes this call from its <A HREF="JavaScript:hhobj_4.Click()"><I>AddDevice</I></A> routine. </P>

<P>Each <B>AddInterface</B> directive in an <A HREF="inf-format_4eeq.htm">INF <I>DDInstall</I><B>.Interfaces </B>section</A> can reference an INF-writer-defined <I>add-interface-section</I> elsewhere in the INF file. Each INF-writer-defined section name must be unique within the INF and must follow the general rules for defining section names. These rules are described in <A HREF="inf-format_7soi.htm">General Syntax Rules for INF Files</A>. </P>

<P>An <I>add-interface-section</I> referenced by the <B>AddInterface</B> directive has the following form:</P>

<P><B>[</B><I>add-interface-section</I><B>]<BR>
&nbsp;</B><BR>
<B>AddReg=</B><I>add-registry-section</I>[<B>,</B> <I>add-registry-section</I>]...<BR>
[<B>DelReg=</B><I>del-registry-section</I>[<B>,</B> <I>del-registry-section</I>] ...]<BR>
[<B>BitReg=</B><I>bit-registry-section</I>[<B>,</B><I>bit-registry-section</I>] ...]<BR>
[<B>CopyFiles=@</B><I>filename</I> | <I>file-list-section</I>[<B>,</B><I>file-list-section</I>]...]<BR>
[<B>DelFiles=</B><I>file-list-section</I>[<B>,</B><I>file-list-section</I>]...]<BR>
[<B>RenFiles=</B><I>file-list-section</I>[<B>,</B><I>file-list-section</I>]...]<BR>
[<B>UpdateInis=</B><I>update-ini-section</I>[<B>,</B> <I>update-ini-section</I>] ...]<BR>
[<B>UpdateIniFields=</B><I>update-inifields-section</I>[<B>,</B> <I>update-inifields-section</I>] ...]<BR>
[<B>Ini2Reg=</B><I>ini-to-registry-section</I>[<B>,</B> <I>ini-to-registry-section</I>] ...]</P>

<P>Typically, an <I>add-interface-section</I> contains only an <A HREF="inf-format_2v02.htm">INF <B>AddReg</B> directive</A> that, in turn, references a single <I>add-registry-section</I>. The <I>add-registry-section</I> is used to store information in the registry about the interfaces supported by the device driver for subsequent use by still higher level drivers and applications. </P>

<P>An <I>add-registry-section</I> referenced within an <I>add-interface-section</I> is both device/driver-specific and interface instance-specific in nature. It might have a value entry defining a friendly name for the exported device interface instance so that still higher level components can refer to that interface by its friendly name in the user interface. An <B>HKR</B> specified in such an <I>add-registry-section</I> section designates the user-mode-accessible device-interface subkey of the <B>..DeviceClasses\{</B><I>InterfaceClassGUID</I><B>}\</B> branch. In the registry, <B>DeviceClasses</B> is a subkey of the <B>..CurrentControlSet\Control</B> key. </P>

<H4>Example</H4>

<P>This example shows some of the expansion of the <I>DDInstall</I>.<B>Interfaces</B> section for a particular audio device that supports system-defined kernel-streaming interfaces. </P>

<PRE>; ...
[ESS6881.Device.Interfaces]
AddInterface=%KSCATEGORY_AUDIO%,%KSNAME_Wave%,ESSAud.Interface.Wave
AddInterface=%KSCATEGORY_RENDER%,%KSNAME_Wave%,ESSAud.Interface.Wave
AddInterface=%KSCATEGORY_CAPTURE%,%KSNAME_Wave%,ESSAud.Interface.Wave
AddInterface=%KSCATEGORY_AUDIO%,%KSNAME_Topology%,\
ESSAud.Interface.Topology
AddInterface=%KSCATEGORY_AUDIO%,%KSNAME_UART%,WDM.Interface.UART
AddInterface=%KSCATEGORY_RENDER%,%KSNAME_UART%,WDM.Interface.UART
AddInterface=%KSCATEGORY_CAPTURE%,%KSNAME_UART%,WDM.Interface.UART
AddInterface=%KSCATEGORY_AUDIO%,%KSNAME_FMSynth%,WDM.Interface.FMSynth
AddInterface=%KSCATEGORY_RENDER%,%KSNAME_FMSynth%,\
WDM.Interface.FMSynth
 
[ESSAud.Interface.Wave]
AddReg=ESSAud.Interface.Wave.AddReg
 
[ESSAud.Interface.Wave.AddReg]
HKR,,CLSID,,%Proxy.CLSID%
HKR,,FriendlyName,,%ESSAud.Wave.szPname%
; ... 
[WDM.Interface.UART]
AddReg=WDM.Interface.UART.AddReg
 
[WDM.Interface.UART.AddReg]
HKR,,CLSID,,%Proxy.CLSID%
HKR,,FriendlyName,,%WDM.UART.szPname%
; ...
[Strings]
KSCATEGORY_AUDIO="{6994ad04-93ef-11d0-a3cc-00a0c9223196}"
KSCATEGORY_RENDER="{65e8773e-8f56-11d0-a3b9-00a0c9223196}"
KSCATEGORY_CAPTURE="{65e8773d-8f56-11d0-a3b9-00a0c9223196}"
; ...
KSNAME_WAVE="Wave"
KSNAME_UART="UART"
; ...
Proxy.CLSID="{17cca71b-ecd7-11d0-b908-00a0c9223196}"
; ... 
ESSAud.Wave.szPname="ESS AudioDrive" 
; ... </PRE>

<H4>See Also</H4>

<P><A HREF="inf-format_2v02.htm"><B>AddReg</B></A>, <A HREF="inf-format_4sj6.htm"><B>BitReg</B></A>, <A HREF="inf-format_4oaa.htm"><B>CopyFiles</B></A>, <A HREF="inf-format_4eeq.htm"><I>DDInstall</I><B>.Interfaces</B></A>, <A HREF="inf-format_3vg2.htm"><B>DelFiles</B></A>, <A HREF="inf-format_21de.htm"><B>DelReg</B></A>, <A HREF="inf-format_2i5u.htm"><B>Ini2Reg</B></A>, <A HREF="inf-format_3o8i.htm"><B>InterfaceInstall32</B></A>, <A HREF="JavaScript:hhobj_5.Click()"><B>IoRegisterDeviceInterface</B></A>, <A HREF="JavaScript:hhobj_6.Click()"><B>IoSetDeviceInterfaceState</B></A>, <A HREF="inf-format_0pki.htm"><B>RenFiles</B></A>, <A HREF="inf-format_5a0i.htm"><B>UpdateIniFields</B></A>, <A HREF="inf-format_4f76.htm"><B>UpdateInis</B></A> </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: INF%20AddInterface%20Directive"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
