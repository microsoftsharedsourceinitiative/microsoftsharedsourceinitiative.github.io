<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>New for Network Drivers</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="New for Network Drivers">
</HEAD>
<BODY TOPMARGIN="0">
<DIV STYLE="display:none;">
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_miniportpnpeventnotify_nr">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_general_objects_nr">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_connection_oriented_objects_nr">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisgeneratepartialcancelid_nr">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndis_set_packet_cancel_id_nr">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndis_get_packet_cancel_id_nr">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndiscancelsendpackets_nr">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_miniportcancelsendpackets_nr">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndismregisterminiport_nr">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisimregisterlayeredminiport_nr">
</OBJECT>
<OBJECT ID="hhobj_11" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndismregisteradaptershutdownhandler_nr">
</OBJECT>
<OBJECT ID="hhobj_12" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_oid_gen_machine_name_nr">
</OBJECT>
<OBJECT ID="hhobj_13" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisminitializescattergatherdma_nr">
</OBJECT>
<OBJECT ID="hhobj_14" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisimgetcurrentpacketstack_nr">
</OBJECT>
<OBJECT ID="hhobj_15" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisimnotifypnpevent_nr">
</OBJECT>
<OBJECT ID="hhobj_16" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndismsetattributesex_nr">
</OBJECT>
<OBJECT ID="hhobj_17" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndiscopyfrompackettopacketsafe_nr">
</OBJECT>
<OBJECT ID="hhobj_18" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisgetpoolfrompacket_nr">
</OBJECT>
<OBJECT ID="hhobj_19" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisquerypendingiocount_nr">
</OBJECT>
<OBJECT ID="hhobj_20" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisgetfirstbufferfrompacketsafe_nr">
</OBJECT>
<OBJECT ID="hhobj_21" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisgetshareddataalignment_nr">
</OBJECT>
<OBJECT ID="hhobj_22" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndismqueryadapterresources_nr">
</OBJECT>
<OBJECT ID="hhobj_23" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisbuffervirtualaddresssafe_nr">
</OBJECT>
<OBJECT ID="hhobj_24" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisgetfirstbufferfrompacketsafe_nr">
</OBJECT>
<OBJECT ID="hhobj_25" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_ndisquerybuffersafe_nr">
</OBJECT>
</DIV>


<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Windows&nbsp;DDK</TD></TR>
</TABLE>
<H2><A NAME="ddk_new_for_network_drivers_pg"></A>New for Network Drivers</H2>

<P>The following network-specific updates are new in Windows&nbsp;XP:

<UL>
	<LI>Plug and Play (PnP) event notification for miniport drivers. 
<P>Through a new miniport driver function, <A HREF="JavaScript:hhobj_1.Click()"><I>MiniportPnPEventNotify</I></A>, miniport drivers are notified of changes in the system power source (battery or AC power) and when a miniport driver's NIC is removed without prior notification to the driver (a surprise removal).
</LI>

	<LI>64-bit statistical counters.
<P>All 100 Mbps and faster NICs must support 64-bit counters for certain statistical OIDs. For more information, see <A HREF="JavaScript:hhobj_2.Click()">General Objects</A> and <A HREF="JavaScript:hhobj_3.Click()">Connection-Oriented Objects</A>.
</LI>

	<LI>Canceling send packets.
<P>Protocol drivers and intermediate drivers can set packet cancellation IDs in packets and request the cancellation of the pending transmission of marked packets. For more information, see <A HREF="JavaScript:hhobj_4.Click()"><B>NdisGeneratePartialCancelId</B></A>, <A HREF="JavaScript:hhobj_5.Click()">NDIS_SET_PACKET_CANCEL_ID</A>, <A HREF="JavaScript:hhobj_6.Click()">NDIS_GET_PACKET_CANCEL_ID</A>, <A HREF="JavaScript:hhobj_7.Click()">NdisCancelSendPackets</A>, and <A HREF="JavaScript:hhobj_8.Click()"><I>MiniportCancelSendPackets</I></A>.
</LI>

	<LI>Registering a <I>MiniportShutdown</I> function.
<P>Miniport and intermediate drivers must register a <I>MiniportShutdown</I> function when calling <A HREF="JavaScript:hhobj_9.Click()"><B>NdisMRegisterMiniport</B></A> or <A HREF="JavaScript:hhobj_10.Click()"><B>NdisIMRegisterLayeredMiniport</B></A>, respectively. Such drivers should no longer call <A HREF="JavaScript:hhobj_11.Click()"><B>NdisMRegisterAdapterShutdownHandler</B></A> to register a <I>MiniportShutdown</I> function.
</LI>

	<LI><A HREF="JavaScript:hhobj_12.Click()">OID_GEN_MACHINE_NAME</A> 
<P>This OID, which is optional, indicates the system name. NDIS sets OID_GEN_MACHINE_NAME only once after a miniport driver completes initialization. NDIS does not dynamically notify miniport drivers of a change in the system name. After changing the system name, a user must reboot the system so that NDIS notifies miniport drivers of the new system name.
</LI>

	<LI><A HREF="JavaScript:hhobj_13.Click()"><B>NdisMInitializeScatterGatherDma</B></A> is supported for serialized miniport drivers.
<P>Serialized miniport drivers can now call <B>NdisMInitializeScatterGatherDma</B> instead of allocating map registers.
</LI>

	<LI>Packet stacking for intermediate drivers.
<P>Each NDIS packet now contains two NDIS_PACKET_STACK structures. After calling <A HREF="JavaScript:hhobj_14.Click()"><B>NdisIMGetCurrentPacketStack</B></A> to obtain a pointer to an NDIS_PACKET_STACK structure, an intermediate driver can store and retrieve driver-defined information at locations referenced by the pointers in this structure. This capability allows the intermediate driver to reuse a packet (that is, pass the packet to the adjacent driver without having to allocate an additional packet into which the intermediate driver copies the original packet).
</LI>

	<LI>Notification of Plug and Play events by intermediate drivers.
<P>An intermediate driver calls <A HREF="JavaScript:hhobj_15.Click()"><B>NdisIMNotifyPnPEvent</B></A> in the context of its <I>ProtocolPnPEvent</I> function to propagate notification of a Plug and Play or Power Management event to the overlying driver.
</LI>

	<LI>New miniport driver attributes.
<P>Callers of <A HREF="JavaScript:hhobj_16.Click()"><B>NdisMSetAttributesEx</B></A>can set three new <I>AttributeFlags</I>:

<P class=indent1>NDIS_ATTRIBUTE_SURPRISE_REMOVE_OK<BR>
NDIS_ATTRIBUTE_SAFE_BUFFER_APIS <BR>
NDIS_ATTRIBUTE_NOT_CO_NDIS</P>
</LI>

	<LI>Miscellaneous new NDIS functions.
<P>For information, see <A HREF="JavaScript:hhobj_17.Click()"><B>NdisCopyFromPacketToPacketSafe</B></A>, <A HREF="JavaScript:hhobj_18.Click()"><B>NdisGetPoolFromPacket</B></A>, <A HREF="JavaScript:hhobj_19.Click()"><B>NdisQueryPendingIoCount</B></A>, <A HREF="JavaScript:hhobj_20.Click()"><B>NdisGetFirstBufferFromPacketSafe</B></A>, and <A HREF="JavaScript:hhobj_21.Click()"><B>NdisGetSharedDataAlignment</B></A>.
</LI>

	<LI>Identifying allocated resources.
<P>Miniport drivers must now use <A HREF="JavaScript:hhobj_22.Click()"><B>NdisMQueryAdapterResources</B></A> to identify allocated system resources.
</LI>

	<LI>Miniport drivers must have default values.
<P>Miniport drivers must have a default value for every key that they read from the registry. 
</LI>

	<LI>Safe functions.
<P>NDIS&nbsp;5.1 miniport drivers must call the safe version of functions (<A HREF="JavaScript:hhobj_23.Click()"><B>NdisBufferVirtualAddressSafe</B></A>, <A HREF="JavaScript:hhobj_24.Click()"><B>NdisGetFirstBufferFromPacketSafe</B></A>, and <A HREF="JavaScript:hhobj_25.Click()"><B>NdisQueryBufferSafe</B></A>) instead of their nonsafe versions.
</LI>

	<LI>Obsolete functions.
<P>The following functions are not supported in Windows&nbsp;XP and later versions of the operating system. NDIS 5.1 drivers should never call these functions. These functions are supported only for legacy NDIS 5.0 and 4.0 drivers: 

<P><B>NdisGetCacheFillSize<BR>
NdisImmediateReadPciSlotInformation<BR>
NdisImmediateReadPortUchar<BR>
NdisImmediateReadPortUlong<BR>
NdisImmediateReadPortUshort<BR>
NdisImmediateReadImmediateSharedMemory<BR>
NdisImmediateWritePciSlotInformation<BR>
NdisImmediateWritePortUchar<BR>
NdisImmediateWritePortUlong<BR>
NdisImmediateWritePortUshort<BR>
NdisImmediateWriteSharedMemory<BR>
NdisMPciAssignResources<BR>
NdisReadEisaSlotInformation<BR>
NdisReadEisaSlotInformationEx</B>

<P>Windows XP and later versions do not support <B>NdisQueryMapRegisterCount</B> for any NDIS drivers.
</LI>

	<LI>Remote NDIS.
<P>Remote NDIS is a bus-independent class specification for Ethernet (802.3) network devices on dynamic PnP busses such as USB, 1394, Bluetooth, and InfiniBand. Remote NDIS defines a bus-independent message protocol between a host PC and a Remote NDIS device over abstract control and data channels. 
</LI>

	<LI>NDIS&nbsp;3.0 protocol drivers are not supported.
<P>Only NDIS&nbsp;4.0 and 5.0 protocol drivers are supported. All protocol drivers must supply <I>ProtocolBindAdapter</I> and <I>ProtocolUnbindAdapter</I> functions.
</LI>

	<LI>Intermediate drivers must be deserialized.</LI>

	<LI>The EISA bus is no longer supported.</LI>
</UL>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: New%20for%20Network%20Drivers"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
