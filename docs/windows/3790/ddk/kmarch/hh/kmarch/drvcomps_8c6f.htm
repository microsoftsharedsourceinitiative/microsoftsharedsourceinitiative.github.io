<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Writing a DriverEntry Routine</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="Writing a DriverEntry Routine">
</HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Kernel-Mode&nbsp;Driver&nbsp;Architecture:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="ddk_writing_a_driverentry_routine_kg"></A>Writing a DriverEntry Routine</H1>

<P>Each driver must have a <A HREF="drvrrtns_6r76.htm"><B>DriverEntry</B></A> routine, which initializes driver-wide data structures and resources. The I/O Manager calls the <B>DriverEntry</B> routine when it loads the driver. </P>

<P>In a driver that supports Plug and Play (PnP), as all drivers should, the <B>DriverEntry</B> routine is responsible for <I>driver</I> initialization, while the <A HREF="drvrrtns_4d6a.htm"><I>AddDevice</I></A> routine (and, possibly, the dispatch routine that handles a PnP <A HREF="pnp-irps_1gqa.htm">IRP_MN_START_DEVICE</A> request) is responsible for <I>device</I> initialization. Driver initialization includes exporting the driver’s other entry points, initializing certain objects the driver uses, and setting up various per-driver system resources. (Legacy, non-PnP drivers have significantly different requirements, as described in the DDK for Windows NT® 4.0 and earlier.)</P>

<P><B>DriverEntry</B> routines are called in the context of a system thread at IRQL = PASSIVE_LEVEL.</P>

<P>A <B>DriverEntry</B> routine can be pageable and should be in an INIT segment so it will be discarded. </P>

<P>This section contains the following topics:</P>

<P class=indent1><A HREF="drvcomps_4mxz.htm"><B>DriverEntry</B>'s Required Responsibilities</A> </P>

<P class=indent1><A HREF="drvcomps_3aqv.htm"><B>DriverEntry</B>'s Optional Responsibilities</A> </P>

<P class=indent1><A HREF="drvcomps_0fxj.htm"><B>DriverEntry</B> Return Values</A> </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Writing%20a%20DriverEntry%20Routine"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
