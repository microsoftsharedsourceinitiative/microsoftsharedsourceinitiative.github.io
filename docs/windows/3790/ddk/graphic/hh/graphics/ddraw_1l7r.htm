<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>VPE and Kernel-Mode Video Transport Architecture</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="VPE and Kernel-Mode Video Transport Architecture">
</HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Display&nbsp;and&nbsp;Print&nbsp;Devices:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H2><A NAME="ddk_vpe_and_kernel_mode_video_transport_architecture_gg"></A>VPE and Kernel-Mode Video Transport Architecture</H2>

<P>This section provides some details about the Windows&nbsp;98/Me and Windows&nbsp;2000 and later architectures for the video port extensions (VPE) and kernel-mode video transport in DirectX 5.0 and later versions. The architecture for kernel-mode video transport is the same under Windows&nbsp;98/Me and Windows&nbsp;2000 and later, based on new functions that Microsoft added as device-independent code. Kernel-mode video transport consists of a <A HREF="ddfncs_7puv.htm"><B>DxApi</B></A> function that is supplied as part of DirectDraw, the <A HREF="ddfncs_5y1z.htm">DxApi callbacks</A> supplied in the <A HREF="vmport_7a1z.htm">video miniport driver</A> (or, for Windows 98/Me, in the miniVDD), and the COM interface methods supplied as part of DirectDraw. </P>

<H4>Windows 98/Me</H4>

<P>In Windows&nbsp;98/Me, the DxApi callbacks are added to the miniVDD, which contains the device-specific code for the graphics device. <B> </B></P>

<P><IMG SRC="images/kmdevsupp.gif" ALT="" BORDER=0></P>

<P><B>Windows 98/Me Kernel-mode Video Transport Architecture</B></P>

<P class=note><B>Note</B>&nbsp;&nbsp;This architecture also supports using the PCI bus for data flow between the MPEG device and VGA device; however, using PCI never results in high-quality output.</P>

<P>In this architecture, DirectShow (or another ring 3 client) calls the new DirectDraw interfaces to get handles to the DirectDraw object and surface objects. The client passes these handles to the kernel-mode driver. These handles are specified in the calls to the kernel-mode video transport. The following figure shows a simple version of this. </P>

<P><IMG SRC="images/handpass.gif" ALT="" BORDER=0></P>

<P><B>Handle Passing in Windows 98/Me Video Transport</B></P>

<H4>Windows 2000 and Later</H4>

<P>In Windows&nbsp;2000 and later, as shown in the following figure, the DxApi callbacks are part of the <A HREF="vmport_7a1z.htm">video miniport driver</A>. For more information about the DxApi callbacks, see <A HREF="ddraw_509z.htm">DxApi Miniport Functions for Windows 2000 and Later</A>. </P>

<P><IMG SRC="images/ddfg011.gif" ALT="" BORDER=0></P>

<P><B>Windows 2000 Kernel-Mode Video Transport Architecture</B></P>

<P>The preceding figure shows the kernel-mode video transport architecture in relation to other kernel-mode and user-mode components (the dashed line denotes the kernel transition). In this architecture, DirectShow (or another user mode client) calls the <A HREF="ddfncs_7293.htm"><B>IDirectDrawKernel</B></A> and <A HREF="ddfncs_6wtj.htm"><B>IDirectDrawSurfaceKernel</B></A> DirectDraw COM interfaces to get handles to the DirectDraw object and surface objects. </P>

<P class=note><B>Note</B>&nbsp;&nbsp;This architecture also supports using the PCI bus for data flow between the MPEG device and VGA device.</P>

<P>In Windows&nbsp;2000 and later, the client then passes these handles to the miniport driver. These handles are specified in the calls to the kernel-mode video transport. The following figure shows a simple version of how the handles are passed. </P>

<P><IMG SRC="images/ddfg012.gif" ALT="" BORDER=0></P>

<P><B>Handle Passing in Windows 2000 Video Transport</B></P>

<P>The preceding figure shows how handles are passed in user- and kernel-mode video transport.</P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: VPE%20and%20Kernel-Mode%20Video%20Transport%20Architecture"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
