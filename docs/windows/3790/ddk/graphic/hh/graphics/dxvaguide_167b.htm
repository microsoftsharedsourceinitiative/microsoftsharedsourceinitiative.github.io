<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Using Four Uncompressed Surfaces for Decoding</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="Using Four Uncompressed Surfaces for Decoding">
</HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Display&nbsp;and&nbsp;Print&nbsp;Devices:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H3><A NAME="ddk_using_four_uncompressed_surfaces_for_decoding_gg"></A>Using Four Uncompressed Surfaces for Decoding </H3>

<P>The following table shows a hypothetical situation in which a video decoder requires one frame time to decode each picture. It decodes a bitstream consisting of a steadily increasing number of B pictures starting from zero B pictures after an initial I picture. The bitstream of B pictures occurs between pairs of P pictures. In this table, a letter shows the type of each picture (I, B, or P), a subscript shows the frame display index (the temporal display order of each picture), and a superscript shows the number of the buffer containing the picture.</P>

<TABLE>

<TR VALIGN="top">
<TH align=left width=33%>Picture Decoded</TH>
<TH align=left width=33%>Picture Displayed</TH>
<TH align=left width=34%>Frames Decoded (at start of interval)</TH>
</TR>

<TR VALIGN="top">
<TD width=33%>I<SUP>0</SUP><SUB>0</SUB></TD>
<TD width=33%>&nbsp;</TD>
<TD width=34%>0</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>P<SUP>1</SUP><SUB>1</SUB></TD>
<TD width=33%>&nbsp;</TD>
<TD width=34%>1</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>P<SUP>2</SUP><SUB>3</SUB></TD>
<TD width=33%>I<SUP>0</SUP><SUB>0</SUB></TD>
<TD width=34%>2</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>3</SUP><SUB>2</SUB></TD>
<TD width=33%>P<SUP>1</SUP><SUB>1</SUB></TD>
<TD width=34%>3</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>P<SUP>0</SUP><SUB>6</SUB></TD>
<TD width=33%>B<SUP>3</SUP><SUB>2</SUB></TD>
<TD width=34%>4</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>1</SUP><SUB>4</SUB></TD>
<TD width=33%>P<SUP>2</SUP><SUB>3</SUB></TD>
<TD width=34%>5</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>3</SUP><SUB>5</SUB></TD>
<TD width=33%>B<SUP>1</SUP><SUB>4</SUB></TD>
<TD width=34%>6</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>P<SUP>2</SUP><SUB>10</SUB></TD>
<TD width=33%>B<SUP>3</SUP><SUB>5</SUB></TD>
<TD width=34%>7</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>1</SUP><SUB>7</SUB></TD>
<TD width=33%>P<SUP>0</SUP><SUB>6</SUB></TD>
<TD width=34%>8</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>3</SUP><SUB>8</SUB></TD>
<TD width=33%>B<SUP>1</SUP><SUB>7</SUB></TD>
<TD width=34%>9</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>1</SUP><SUB>9</SUB></TD>
<TD width=33%>B<SUP>3</SUP><SUB>8</SUB></TD>
<TD width=34%>10</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>P<SUP>0</SUP><SUB>15</SUB></TD>
<TD width=33%>B<SUP>1</SUP><SUB>9</SUB></TD>
<TD width=34%>11</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>3</SUP><SUB>11</SUB></TD>
<TD width=33%>P<SUP>2</SUP><SUB>10</SUB></TD>
<TD width=34%>12</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>1</SUP><SUB>12</SUB></TD>
<TD width=33%>B<SUP>3</SUP><SUB>11</SUB></TD>
<TD width=34%>13</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>3</SUP><SUB>13</SUB></TD>
<TD width=33%>B<SUP>1</SUP><SUB>12</SUB></TD>
<TD width=34%>14</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>1</SUP><SUB>14</SUB></TD>
<TD width=33%>B<SUP>3</SUP><SUB>13</SUB></TD>
<TD width=34%>15</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>P<SUP>2</SUP><SUB>21</SUB></TD>
<TD width=33%>B<SUP>1</SUP><SUB>14</SUB></TD>
<TD width=34%>16</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>3</SUP><SUB>16</SUB></TD>
<TD width=33%>P<SUP>2</SUP><SUB>21</SUB></TD>
<TD width=34%>17</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>1</SUP><SUB>17</SUB></TD>
<TD width=33%>B<SUP>3</SUP><SUB>16</SUB></TD>
<TD width=34%>18</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>3</SUP><SUB>18</SUB></TD>
<TD width=33%>B<SUP>1</SUP><SUB>17</SUB></TD>
<TD width=34%>19</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>1</SUP><SUB>19</SUB></TD>
<TD width=33%>B<SUP>3</SUP><SUB>18</SUB></TD>
<TD width=34%>20</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>B<SUP>3</SUP><SUB>20</SUB></TD>
<TD width=33%>B<SUP>1</SUP><SUB>19</SUB></TD>
<TD width=34%>21</TD>
</TR>

<TR VALIGN="top">
<TD width=33%>P<SUP>0</SUP><SUB>28</SUB></TD>
<TD width=33%>B<SUP>3</SUP><SUB>20</SUB></TD>
<TD width=34%>22</TD>
</TR>
</TABLE><BR>

<P>Each B picture in the preceding table requires the decoding of two prior pictures in bitstream order before it can be decoded. As a consequence, the decoder cannot begin displaying pictures with their proper timing until after the second picture has been decoded (that is, until during the third time slice of decoding). Somewhere during this time slice, the display of pictures with their proper timing can begin.</P>

<P>The initiation of the display of a picture may not perfectly coincide with the picture that appears on the display. Instead, the display may continue to show a picture prior to the one that was sent for display until the proper time arrives to switch to the new picture. For optimal performance, surface 0 (which holds the first I picture) should not be overwritten for use by the B picture that arrives three frame times later, even though the I picture is not needed by that B picture for referencing. Instead, a fourth surface (surface 3) should be used to hold that B picture. This eliminates the need to check whether the display period of the first I picture has been completed before decoding the B picture.</P>

<P>The two rules described in <A HREF="dxvaguide_1r1j.htm">sequence requirements</A> for decoders require that each of the first three decoded pictures be placed in different surfaces, because none of them has been displayed until some time during the third period (period 2). Then, the fourth decoded picture should be placed in a fourth surface, because the display of the first displayed picture may not yet be over until some time during the fourth period (period 3).</P>

<P>A significant obstacle in the decoding process occurs as a result of having more than two B pictures in succession. This occurs in the preceding table upon encountering the tenth decoded picture (B<SUP>1</SUP><SUB>9</SUB>). When the third or subsequent B picture in a contiguous series is encountered, the time lag tolerance between the display of one B picture and the use of a surface to hold the next decoded B picture is eliminated. The host decoder must check the display status of the B picture that was displayed in the previous period (B<SUP>1</SUP><SUB>7</SUB>) to ensure that it has been removed from the display (waiting for this to happen if necessary), then it must immediately use the same surface for the next B picture to be decoded (surface 1 used for B<SUP>1</SUP><SUB>9</SUB>). The decoder cannot decode the new B picture into either of the surfaces being used to hold its reference I or P pictures (in this case, surfaces 0 and 2 used for P<SUP>0</SUP><SUB>6</SUB> and P<SUP>2</SUP><SUB>10</SUB>), and cannot decode the new B picture into the surface being displayed during the same interval of time (in this case, surface 3 used for B<SUP>3</SUP><SUB>8</SUB>). Thus, it must use the surface that was displayed in the immediately preceding period (in this case, surface 1).</P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Using%20Four%20Uncompressed%20Surfaces%20for%20Decoding"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
