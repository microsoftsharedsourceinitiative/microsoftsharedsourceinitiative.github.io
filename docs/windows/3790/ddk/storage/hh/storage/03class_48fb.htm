<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Queueing Storage Requests</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="Queueing Storage Requests">
</HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Storage&nbsp;Devices:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H2><A NAME="ddk_queueing_storage_requests_kg"></A>Queueing Storage Requests</H2>

<P>Although it is possible for a storage class driver to set up internal queues for IRPs, it is seldom necessary to do so and likely to degrade the driver's performance as well, because the storage port driver already maintains driver-created, LU-specific device queues for IRPs. Whether or not a particular HBA supports multiple outstanding commands (for example, SCSI tagged queuing), storage class drivers can send every request to their devices as each IRP comes in and rely on the system-supplied port driver or the HBA to handle queued requests expeditiously.</P>

<P>When certain SCSI errors occur, the system port driver freezes the appropriate LU-specific queue and notifies the class driver. For more information about handling errors and releasing frozen request queues, see the following:</P>

<P class=indent1><A HREF="03class_1up3.htm">Storage Class Driver's <I>ReleaseQueue</I> Routine</A> </P>

<P class=indent1><A HREF="03class_9w9z.htm">Storage Class Driver's <I>InterpretRequestSense</I> Routine</A> </P>

<P class=indent1><A HREF="03class_7o6f.htm">Storage Class Driver's <I>RetryRequest</I> Routine</A> </P>

<P>If an HBA supports command queuing, as indicated in the returned STORAGE_ADAPTER_DESCRIPTOR data, the class driver sets SRB_FLAGS_QUEUE_ENABLE and uses the <B>QueueAction</B> member of the SRBs it creates to control how its requests are queued. </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Queueing%20Storage%20Requests"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
