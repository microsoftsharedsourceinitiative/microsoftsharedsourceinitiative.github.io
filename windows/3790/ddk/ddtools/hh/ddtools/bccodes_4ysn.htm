<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Bug Check 0xE6:  DRIVER_VERIFIER_DMA_VIOLATION</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="bug check 0xE6">
<META NAME="MS-HKWD" CONTENT="DRIVER_VERIFIER_DMA_VIOLATION">
<META NAME="MS-HKWD" CONTENT="Driver Verifier, bug check 0xE6">
</HEAD>
<BODY TOPMARGIN="0">
<DIV STYLE="display:none;">
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_iogetdmaadapter_kr">
</OBJECT>
</DIV>


<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Driver&nbsp;Development&nbsp;Tools:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="ddk_bug_check_0xe6_bug"></A>Bug Check 0xE6: DRIVER_VERIFIER_DMA_VIOLATION</H1>

<P>The DRIVER_VERIFIER_DMA_VIOLATION bug check has a value of 0x000000E6. This is the bug check code for all Driver Verifier <B>DMA Verification</B> violations.</P>

<H4>Parameters</H4>

<P>The following parameters are displayed on the blue screen. Parameter&nbsp;1 is the only parameter of interest; this identifies the exact violation. If a debugger is attached, an informative message is displayed in the debugger.</P>

<TABLE>

<TR VALIGN="top">
<TH align=left width=18%>Parameter 1</TH>
<TH align=left width=82%>Cause of Error and Debugger Message</TH>
</TR>

<TR VALIGN="top">
<TD width=18%>0x00</TD>
<TD width=82%>This code can represent two different kinds of errors:
<P>1. The driver attempted to flush too many bytes to the end of the map register file. <I>The number of bytes permitted and the number of bytes attempted are displayed.</I></P>

<P>2. Windows has run out of contiguous map registers. <I>The number of map registers needed and the largest block of contiguous map registers is displayed.</I></P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x01</TD>
<TD width=82%>The performance counter has decreased. <I>The old and new values of the counter are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x02</TD>
<TD width=82%>The performance counter has increased too fast. <I>The counter value is displayed in the debugger.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x03</TD>
<TD width=82%>The driver freed too many DMA common buffers. Usually this means it freed the same buffer twice.</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x04</TD>
<TD width=82%>The driver freed too many DMA adapter channels. Usually this means it freed the same adapter channel twice.</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x05</TD>
<TD width=82%>The driver freed too many DMA map registers. Usually this means it freed the same map register twice. <I>The number of active map registers is displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x06</TD>
<TD width=82%>The driver freed too many DMA scatter-gather lists. Usually this means it freed the same scatter-gather list twice. <I>The number of lists allocated and the number of lists freed is displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x07</TD>
<TD width=82%>The driver attempted to release the adapter without first freeing all its common buffers. <I>The adapter address and the number of remaining buffers is displayed.</I>    </TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x08</TD>
<TD width=82%>The driver attempted to release the adapter without first freeing all adapter channels, common buffers, or scatter-gather lists. <I>The adapter address and the number of remaining items is displayed.</I>    </TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x09</TD>
<TD width=82%>The driver attempted to release the adapter without first freeing all map registers. <I>The adapter address and the number of remaining map registers is displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x0A</TD>
<TD width=82%>The driver attempted to release the adapter without first freeing all its scatter-gather lists. <I>The adapter address and the number of remaining scatter-gather lists is displayed.</I>    </TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x0B</TD>
<TD width=82%>The driver has allocated too many adapter channels simultaneously. (Only one adapter channel is permitted per adapter.)</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x0C</TD>
<TD width=82%>The driver attempted to allocate too many map registers at one time. <I>The number requested and the number allowed are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x0D</TD>
<TD width=82%>The driver did not flush its adapter buffers. <I>The number of bytes that the driver attempted to map and the maximum number of bytes allowed are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x0E</TD>
<TD width=82%>The driver attempted a DMA transfer without locking the buffer. The buffer in question was in paged memory. <I>The address of the MDL is displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x0F</TD>
<TD width=82%>The driver or the hardware wrote outside of its allocated DMA buffer. <I>The nature of the error (overrun or underrun) is displayed, as well as the relevant addresses.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x10</TD>
<TD width=82%>The driver attempted to free its map registers while some were still mapped. <I>The number of map registers still mapped is displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x11</TD>
<TD width=82%>The driver has too many outstanding reference counts for the adapter. <I>The number of reference counts and the adapter address are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x13</TD>
<TD width=82%>The driver called a DMA routine at an improper IRQL. <I>The required IRQL and the actual IRQL are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x14</TD>
<TD width=82%>The driver called a DMA routine at an improper IRQL. <I>The required IRQL and the actual IRQL are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x15</TD>
<TD width=82%>The driver attempted to allocate too many map registers. <I>The number requested and the number allowed are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x16</TD>
<TD width=82%>The driver attempted to flush a buffer that isn't mapped. <I>The address of the buffer is displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x18</TD>
<TD width=82%>The driver attempted a DMA operation using an adapter that was already released and no longer exists. <I>The adapter address is displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x19</TD>
<TD width=82%>The driver passed a null DMA_ADAPTER value to a HAL routine.</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x1B</TD>
<TD width=82%>The driver passed an address and MDL to a HAL routine, but this address is not within the bounds of this MDL. <I>The address passed and the address of the MDL are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x1D</TD>
<TD width=82%>The driver attempted to map an address range that was already mapped. <I>The address range and the current mapping for that range are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x1E</TD>
<TD width=82%>The driver called <B>HalGetAdapter</B>. This function is obsolete — you must use <A HREF="JavaScript:hhobj_1.Click()"><B>IoGetDmaAdapter</B></A> instead.</TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x1F</TD>
<TD width=82%>The driver referenced an invalid system address — either before the first MDL, or after the end of the first MDL, or using a transfer length that is longer than the MDL buffer and crosses a page boundary within the MDL. <I>Either the invalid address and the first MDL address, or the MDL address and the extra transfer length are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x20</TD>
<TD width=82%>The driver attempted to flush a map register that hasn't been mapped. <I>The map register base, flushing address, and MDL are displayed.</I></TD>
</TR>

<TR VALIGN="top">
<TD width=18%>0x21</TD>
<TD width=82%>The driver attempted to map a zero-length buffer for transfer.</TD>
</TR>
</TABLE><BR>

<H4>Cause</H4>

<P>See the description of each code in the Parameters section for a description of the cause.</P>

<H4>Resolving the Problem</H4>

<P>This bug check can only occur when Driver Verifier has been instructed to monitor one or more drivers. If you did not intend to use Driver Verifier, you should deactivate it. You might consider removing the driver which caused this problem as well.</P>

<P>If you are the driver writer, use the information obtained through this bug check to fix the bugs in your code.</P>

<P>The Driver Verifier <B>DMA Verification</B> option is only available in Windows&nbsp;XP and later. For full details, see <A HREF="dv_7g8j.htm">Driver Verifier</A>.  </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Bug%20Check%200xE6:%20%20DRIVER_VERIFIER_DMA_VIOLATION"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
