<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Introduction to CUV</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="Introduction to CUV">
</HEAD>
<BODY TOPMARGIN="0">
<DIV STYLE="display:none;">
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_standard_driver_routines_kr">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_insertheadlist_kr">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_initializelisthead_kr">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_keacquireinstackqueuedspinlock_kr">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_keacquirespinlock_kr">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_exinterlockedremoveheadlist_kr">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_iogetcurrentirpstacklocation_kr">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_iosetnextirpstacklocation_kr">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_iogetnextirpstacklocation_kr">
</OBJECT>
</DIV>


<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Driver&nbsp;Development&nbsp;Tools:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H2><A NAME="ddk_introduction_to_cuv_tools"></A>Introduction to CUV</H2>

<P>Call Usage Verifier (CUV) helps driver writers locate and identify driver bugs. CUV adds to the types of error checking that Driver Verifier performs.</P>

<P class=proch><B><IMG SRC="../images/wedge.gif" ALT="" BORDER=0>To use CUV</B>

<OL>
	<LI>Set an environment variable before building your driver. For more information, see <A HREF="cuv_9kkz.htm">Building Drivers with CUV</A>.</LI>

	<LI>Run your driver on a Windows system with a kernel debugger attached. For more information, see <A HREF="dbgblurb_2t83.htm">Debuggers</A>.</LI>
</OL>

<P>If you build a driver with CUV but don't run a kernel debugger, the driver will run but CUV cannot report errors.</P>

<H4>Supported Driver Types</H4>

<P>CUV supports standard kernel-mode Windows drivers that include <I>wdm.h</I> or <I>ntddk.h</I>. You can use CUV only if your <I>sources</I> file sets the <A HREF="build_ref_8ctv.htm">TARGETTYPE</A> build macro equal to DRIVER and does not use the <A HREF="build_ref_3d2r.htm">DRIVERTYPE</A> macro.</P>

<H4>Supported Platforms</H4>

<P>Drivers that are built with CUV can execute under Windows®&nbsp;XP and later versions of Windows. CUV is not available in the Windows&nbsp;2000 build environments, and drivers built with CUV should not be run on Windows 2000.</P>

<H4>Supported Bug Types</H4>

<P>CUV tests for four main categories of driver bugs:

<UL>
	<LI><B>Initialization Errors</B>
<P>Before the driver uses some system-defined data structures, CUV ensures that the driver has called the appropriate <A HREF="JavaScript:hhobj_1.Click()">standard driver routine</A> to initialize the structure. For example, before a list head is used in a call to <A HREF="JavaScript:hhobj_2.Click()"><B>InsertHeadList</B></A>, CUV ensures that the driver has initialized the list head by calling <A HREF="JavaScript:hhobj_3.Click()"><B>InitializeListHead</B></A>. Additionally, CUV ensures that data structures are not initialized more than once, because initializing a data structure after it has already been initialized and used can cause data loss.
</LI>

	<LI><B>Consistency Errors</B>
<P>CUV ensures that driver data structures are used properly and consistently. For example, if a driver uses a spin lock as an in-stack queued spin lock (by calling <A HREF="JavaScript:hhobj_4.Click()"><B>KeAcquireInStackQueuedSpinLock</B></A>), CUV reports an error if the driver later uses that same spin lock as an executive spin lock (by calling, for example, <A HREF="JavaScript:hhobj_5.Click()"><B>KeAcquireSpinLock</B></A>). Likewise, drivers must always protect an interlocked list head by using the same spin lock.
</LI>

	<LI><B>Paged Memory Errors</B>
<P>CUV ensures that driver data structures that must be in nonpaged memory are located appropriately. For example, a LIST_ENTRY structure that is used as a list head can generally be located in either paged or nonpaged memory, but if a driver uses <A HREF="JavaScript:hhobj_6.Click()"><B>ExInterlockedRemoveHeadList</B></A> to remove entries from a list, the list head must be in nonpaged memory.
</LI>

	<LI><B>IRP Stack Location Errors</B>
<P>CUV ensures that the driver references IRP stack locations correctly. For example, CUV reports an error if the driver calls <A HREF="JavaScript:hhobj_7.Click()"><B>IoGetCurrentIrpStackLocation</B></A> for a newly created IRP without first calling <A HREF="JavaScript:hhobj_8.Click()"><B>IoSetNextIrpStackLocation</B></A>, or if the driver calls <A HREF="JavaScript:hhobj_9.Click()"><B>IoGetNextIrpStackLocation</B></A> when no more stack locations are available in the IRP.
</LI>
</UL>

<P>CUV does not validate calls to every standard driver routine. See <A HREF="cuv_0g6r.htm">CUV Function Validation Details</A> for a list of all standard driver routines that are validated.</P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Introduction%20to%20CUV"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
