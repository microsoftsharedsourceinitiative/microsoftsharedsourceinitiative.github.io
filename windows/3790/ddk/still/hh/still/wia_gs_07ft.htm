<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>INF Files for WIA Devices</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="INF Files for WIA Devices">
</HEAD>
<BODY TOPMARGIN="0">
<DIV STYLE="display:none;">
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_ddinstall_section_dr">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_addreg_directive_dr">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_ddinstall_section_dr">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_ddinstall_section_dr">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_addreg_directive_dr">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_copyfiles_directive_dr">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_ddinstall_section_dr">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_ddinstall.services_section_dr">
</OBJECT>
</DIV>


<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Still&nbsp;Image&nbsp;Devices:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="ddk_inf_files_for_wia_devices_si"></A>INF Files for WIA Devices</H1>

<P>The default class installer for still image devices, <I>sti_ci.dll</I>, recognizes a special set of INF file entries. Within an INF file, these entries must be placed within a device's <A HREF="JavaScript:hhobj_1.Click()">INF <I>DDInstall</I> section</A>. The entries are described in the following table.</P>

<TABLE>

<TR VALIGN="top">
<TH align=left width=31%>INF File Entry</TH>
<TH align=left width=34%>Value</TH>
<TH align=left width=35%>Comments</TH>
</TR>

<TR VALIGN="top">
<TD width=31%><B>SubClass</B></TD>
<TD width=34%>StillImage</TD>
<TD width=35%>Required</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>DeviceType</B></TD>
<TD width=34%>1 for scanners<BR>
2 for cameras<BR>
3 for streaming video</TD>
<TD width=35%>Required</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>DeviceSubType</B></TD>
<TD width=34%>Vendor-defined value</TD>
<TD width=35%>Optional</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>Connection</B></TD>
<TD width=34%>For non-Plug and Play devices connected to serial or parallel ports, this can be Serial or Parallel to limit the user's choice of ports during installation.</TD>
<TD width=35%>Optional<BR>
If not specified, the user can select any serial or parallel port.</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>Capabilities</B></TD>
<TD width=34%>Specifies a number that is converted to bit flags identifying device capabilities. These flags are stored in the registry and are available to STI components by means of the STI_DEV_CAPS structure. 
<P>Bit 0 – Sets/clears STI_GENCAP_NOTIFICATIONS in STI_DEV_CAPS.</P>

<P>Bit 1 – Sets/clears STI_GENCAP_POLLING_NEEDED in STI_DEV_CAPS.</P>

<P>Bit 2 – Sets/clears STI_GENCAP_GENERATE_ARRIVALEVENT in STI_DEV_CAPS.</P>

<P>Bit 3 – Sets/clears STI_GENCAP_AUTO_PORTSELECT in STI_DEV_CAPS.</P>

<P>Bit 4 – Sets/clears STI_GENCAP_WIA in STI_DEV_CAPS.</P>

<P>Bit 5 – Sets/clears STI_GENCAP_SUBSET in STI_DEV_CAPS.</P>
</TD>
<TD width=35%>Optional<BR>
Bit 5 is currently not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>PropertyPages</B></TD>
<TD width=34%>For Windows&nbsp;98 and Windows&nbsp;2000 only
<P>Identifies the name and entry point of a DLL that creates customized property sheet pages for still image devices.<BR>
For more information about the <B>PropertyPages</B> entry, see <A HREF="stillimg_8qax.htm">INF Files for Still Image Devices</A>.</P>
</TD>
<TD width=35%>Optional<BR>
This entry is for use only by STI drivers, and is obsolete for WIA drivers. <BR>
For information about property pages relevant to WIA driver developers, see <B>Note on PropertyPages</B> following this table.</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>DeviceData</B></TD>
<TD width=34%>Identifies a vendor-supplied data section containing information to be stored in the registry, under the <B>DeviceData</B> key. For TWAIN-supported devices, the data section must contain a TwainDS entry (see <A HREF="wia_gs_3ns9.htm">Registry Entries for Still Image Drivers</A>).</TD>
<TD width=35%>Optional</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>Events</B></TD>
<TD width=34%>Identifies a vendor-supplied data section listing still image device events. Each entry in this section must have the following format: 
<P><I>EventName</I><B>="</B><I>String</I><B>",{</B><I>GUID</I><B>},</B>App</P>

<P><I>EventName</I> is the event's internal name, <I>String</I> is the event's display string, <I>GUID</I> is the event's GUID, and <I>App</I> specifies the imaging application to be launched when the event occurs. To launch the currently registered application, use an asterisk (<B>*</B>) for <I>App</I>.</P>
</TD>
<TD width=35%>Required</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>PortSelect</B></TD>
<TD width=34%>If the device installation does not require a port selection page, a value of "no" causes that page to be skipped. This value also causes the <B>CreateFileName</B> entry value (see <B>Note on CreateFileName and PortSelect</B> following this table) to be automatically set to AUTO.<BR>
A value of Message1 causes a system-supplied message to be displayed, and sets the <B>CreateFileName</B> entry value to AUTO.<BR>
Applies to both scanners and cameras that require manual installation.</TD>
<TD width=35%>Optional
<P>Note that for Plug and Play devices, <B>PortSelect</B> is ignored, but the device still must have the <B>CreateFileName</B> entry value set to AUTO in order for WIA to load the device. Use the <A HREF="JavaScript:hhobj_2.Click()">INF <B>AddReg</B> directive</A> to add this entry to the <A HREF="JavaScript:hhobj_3.Click()">INF <I>DDInstall </I>section</A> of the device's INF file.</P>
</TD>
</TR>
</TABLE><BR>

<P class=note><B>Note on CreateFileName and PortSelect</B>&nbsp;&nbsp;In order to communicate with a device, a user-mode client (a minidriver) must ask the WIA service for the device's file name and a string that specifies the name of the object to create or open. (The file name does not have to be the name of a disk file.) Responding to such a query, the WIA service obtains the device's file name from the <B>CreateFileName</B> registry entry. (The <I>usbscan.sys</I> and <I>scsiscan.sys</I> kernel-mode drivers create this entry, as does the class installer.) The minidriver receives this file name by calling the <A HREF="stifnc_9oa1.htm"><B>IStiDeviceControl::GetMyDevicePortName</B></A> method. The minidriver can then use this file name when it calls the <B>CreateFile</B> function (described in the Platform SDK documentation) to open a handle to the device.</P>

<P class=note>If the device is installed manually, the class installer creates the <B>CreateFileName</B> entry, setting its value to one that depends on the user's selection on the port selection page: COM<I>X</I>, LPT<I>X</I>, or AUTO. Some devices (network scanners, for example) that are installed manually do not require a port. In such cases, the resulting port selection dialog can confuse users. You can prevent this dialog from appearing by adding the following entry in the <A HREF="JavaScript:hhobj_4.Click()">INF <I>DDInstall</I> section</A> of your device's INF file:</P>

<PRE>     PortSelect=NO
</PRE>

<P class=note>A side effect of this entry value is that the <B>CreateFileName</B> entry is set to AUTO. Be advised that if the minidriver receives AUTO for the file name, it must be able to determine on its own which device it should communicate with.</P>

<P class=note><B>Note on PropertyPages</B>&nbsp;&nbsp;A WIA driver must use a different extensibility mechanism in order to add property pages. It must also add its own GUID to the <B>UI Class ID</B> entry in its INF files, and must provide specific UI extensibility registration (see <A HREF="wia_drv_cus_01ih.htm">User Interface Extension Registry Entries</A>) for the UI components being replaced, such as common dialogs, or added, such as context menus and property pages. A WIA driver must also provide UI extensibility registration for the component itself.</P>

<H4>Additional INF File Entries</H4>

<P>The entries in the following table must be placed within the section pointed to by the device's <A HREF="JavaScript:hhobj_5.Click()">INF <B>AddReg</B> directive</A>:</P>

<TABLE>

<TR VALIGN="top">
<TH align=left width=31%>INF File Entry</TH>
<TH align=left width=34%>Value</TH>
<TH align=left width=35%>Comments</TH>
</TR>

<TR VALIGN="top">
<TD width=31%><B>HardwareConfig</B></TD>
<TD width=34%>Indicates the type of connection the device is using.
<P>1,1 – generic WDM device<BR>
1,2 – SCSI device<BR>
1,4 – USB device<BR>
1,8 – serial device<BR>
1,16 – parallel device</P>
</TD>
<TD width=35%>Optional</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>USDClass</B></TD>
<TD width=34%>Indicates the GUID for the minidriver.</TD>
<TD width=35%>Optional.<BR>
The GUID in the <B>USDClass</B> and <B>CLSID</B> entries must match the GUID that is used in the <B>DllGetClassObject</B> function (described in the Platform SDK documentation) of the minidriver. If you are writing a microdriver, the value should be BB6CF8E2-1511-40bd-91BA-80D43C53064E. Otherwise, you must generate a new GUID, using, for example, <I>genguid.exe</I>.</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>CLSID</B></TD>
<TD width=34%>Indicates the GUID for the minidriver.</TD>
<TD width=35%>Optional.<BR>
See the immediately preceding comments for the <B>USDClass</B> entry.</TD>
</TR>
</TABLE><BR>

<P>The default class installer for still image devices supports the standard <A HREF="JavaScript:hhobj_6.Click()">INF <B>CopyFiles</B> directive</A>. </P>

<P>The default INF file for still image devices, <I>sti.inf</I>, defines two installation sections for each device type, as follows: 

<UL>
	<LI>An <A HREF="JavaScript:hhobj_7.Click()">INF <I>DDInstall</I> section</A>, which must be referenced within the <I>DDInstall</I> section of the vendor-supplied INF file, as shown in the following table. </LI>
</UL>

<TABLE>

<TR VALIGN="top">
<TH align=left width=24%>Device Type</TH>
<TH align=left width=32%>Include</TH>
<TH align=left width=44%>Needs</TH>
</TR>

<TR VALIGN="top">
<TD width=24%>IEEE 1394/SBP2</TD>
<TD width=32%>Include=sti.inf</TD>
<TD width=44%>Needs=STI.SBP2Section</TD>
</TR>

<TR VALIGN="top">
<TD width=24%>USB</TD>
<TD width=32%>Include=sti.inf</TD>
<TD width=44%>Needs=STI.USBSection</TD>
</TR>

<TR VALIGN="top">
<TD width=24%>SCSI</TD>
<TD width=32%>Include=sti.inf</TD>
<TD width=44%>Needs=STI.SCSISection</TD>
</TR>

<TR VALIGN="top">
<TD width=24%>Serial</TD>
<TD width=32%>Include=sti.inf</TD>
<TD width=44%>Needs=STI.SerialSection</TD>
</TR>
</TABLE><BR>

<UL>
	<LI>An INF DDInstall Services section, which must be referenced within the <A HREF="JavaScript:hhobj_8.Click()"><I>DDInstall</I>.<B>Services</B> section</A> of the vendor-supplied INF file, as shown in the following table. </LI>
</UL>

<TABLE>

<TR VALIGN="top">
<TH align=left width=24%>Device Type</TH>
<TH align=left width=32%>Include</TH>
<TH align=left width=44%>Needs</TH>
</TR>

<TR VALIGN="top">
<TD width=24%>1394/SBP2</TD>
<TD width=32%>Include=sti.inf</TD>
<TD width=44%>Needs=STI.SBP2Section.Services</TD>
</TR>

<TR VALIGN="top">
<TD width=24%>USB</TD>
<TD width=32%>Include=sti.inf</TD>
<TD width=44%>Needs=STI.USBSection.Services</TD>
</TR>

<TR VALIGN="top">
<TD width=24%>SCSI</TD>
<TD width=32%>Include=sti.inf</TD>
<TD width=44%>Needs=STI.SCSISection.Services</TD>
</TR>

<TR VALIGN="top">
<TD width=24%>Serial</TD>
<TD width=32%>Include=sti.inf</TD>
<TD width=44%>Needs=STI.SerialSection.Services</TD>
</TR>
</TABLE><BR>

<P>For additional guidance in creating INF files for still image devices, you can look at any INF file provided with Windows&nbsp;2000 and later that contains the entry SubClass=StillImage.</P>

<P>To designate the device as a WIA device, the minidriver INF file must contain the following values placed within the <I>DeviceData</I> section of the vendor-supplied INF file.</P>

<TABLE>

<TR VALIGN="top">
<TH align=left width=31%>INF File Entry</TH>
<TH align=left width=34%>Value</TH>
<TH align=left width=35%>Comments</TH>
</TR>

<TR VALIGN="top">
<TD width=31%><B>Server</B></TD>
<TD width=34%>Local</TD>
<TD width=35%>Designates the device as a local device. This is optional for Windows XP and later. If a vendor does not specify an entry value, the device is assumed to be local. That is, the WIA_DIP_SERVER_NAME property is set to Local.</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>MicroDriver</B></TD>
<TD width=34%>Vendor-supplied <I>.dll</I> file name</TD>
<TD width=35%>This entry should be set to the name of the vendor-supplied DLL that implements the WIA microdriver.</TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>UI DLL</B></TD>
<TD width=34%>Vendor-supplied <I>.dll</I> file name</TD>
<TD width=35%>Obsolete and never used. Formerly, this entry indicated the name of the vendor-supplied user interface DLL file. </TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>UI Class ID</B></TD>
<TD width=34%>Vendor-supplied device class identifier</TD>
<TD width=35%>Indicates the device class the vendor-supplied user interface is capable of supporting. This is optional for Windows XP and later. If a vendor does not specify an entry value, WIA sets the WIA_DIP_UI_CLSID property to GUID_NULL and the default WIA UI is used. </TD>
</TR>

<TR VALIGN="top">
<TD width=31%><B>ICMProfiles</B></TD>
<TD width=34%>Vendor-supplied color profile value</TD>
<TD width=35%>Specifies a value to put in the WIA_IPA_ICM_PROFILE_NAME property (described in the Platform SDK documentation). If no value is specified, the standard sRGB profile <I>sRGB Color Space Profile.icm</I> is used.</TD>
</TR>
</TABLE><BR>

<P>The <B>MicroDriver</B> entry is required only if the vendor supplies a WIA microdriver.</P>

<P>The user interface (UI) entries are required only if the vendor supplies a custom user interface for the imaging device. </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: INF%20Files%20for%20WIA%20Devices"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
