<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Kernel-Mode Video Transport</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="Kernel-Mode Video Transport">
</HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Display&nbsp;and&nbsp;Print&nbsp;Devices:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="ddk_kernel_mode_video_transport_gg"></A>Kernel-Mode Video Transport</H1>

<P>This topic describes kernel-mode video transport as it exists on the Windows&nbsp;98/Me and Windows&nbsp;2000 and later operating systems.</P>

<P>Kernel-mode video transport refers to a new DirectDraw component in ring 0 (kernel mode) that enhances video functionality. This component accesses the DxApi interface. This interface is added to the virtual display miniport driver (miniVDD) in Windows&nbsp;98/Me, and to the <A HREF="vmport_7a1z.htm">video miniport driver</A> under Windows 2000 and later. </P>

<H4>Windows 98/Me</H4>

<P>The HAL for the DxApi interface is added to the miniVDD in Windows&nbsp;98/Me. </P>

<P>A primary role of this new functionality is to hook an IRQ generated by the video port when V-sync occurs, and then to call the miniVDD to tell it to perform video port and overlay flips. This capability can support up to ten buffers without encountering hardware limitations, as long as the video port supports the V-sync IRQ. This capability is used automatically by the versions of DirectDraw supplied with DirectX 5.0 and above when autoflipping is specified by the client and the hardware cannot autoflip. </P>

<P>The need for this capability stems in part from the current limitations on hardware solutions, which typically support only two buffers, with no support for the new bob and weave quality algorithms tied to the video port IRQ. If the video port supports a V-sync IRQ, then this new DirectX capability can emulate autoflipping and field skipping, greatly enhancing the quality of video needed to support DVD and other video playback requirements. </P>

<P>The kernel-mode video transport also ensures enhanced capture support. Under Windows 98/Me and Windows 2000 and later, the WDM-based video capture driver runs in kernel mode, with direct access to the frame buffer. The capture driver can "manually" flip overlays. The kernel-mode video transport HAL can provide V-sync notification from the video port or display; it can also get field polarities, which can be useful when capturing vertical blanking interval (VBI) data. </P>

<P>Although the primary purpose of the kernel-mode HAL is to enhance VPE autoflipping capabilities, it also supports video bus masters, which can write data while in kernel mode. The bus master can be notified before losing the surface because of a mode change, or because a full-screen MS-DOS instance is launched. Because the new HAL support allows a bus master to be called before the changes occur, the bus master can shut off without causing a problem. </P>

<H4>Windows 2000 and Later</H4>

<P>Kernel-mode video transport refers to a Microsoft® DirectDraw® component that a client, such as Microsoft DirectShow®, can use to enhance video functionality. A primary role of this functionality is to call the miniport driver to tell it to perform hardware video port and overlay flips when V-sync occurs. This capability can support up to ten buffers without encountering hardware limitations, as long as the hardware video port supports the V-sync interrupt request (IRQ). This capability is used automatically by the versions of DirectDraw supplied with Microsoft DirectX® 5.0 and later versions when autoflipping is specified by the client and the hardware cannot autoflip. </P>

<P>The kernel-mode video transport also ensures enhanced capture support. Under Microsoft Windows® 98/Me and Microsoft Windows®&nbsp;2000 and later, the WDM-based video capture driver runs in kernel mode, with direct access to the frame buffer. The capture driver can "manually" flip overlays. The Windows&nbsp;2000 and later miniport video transport driver can provide V-sync notification from the hardware video port or display; it can also get field polarities, which can be useful when capturing vertical blanking interval (VBI) data. </P>

<P>Although the primary purpose of the kernel-mode driver is to enhance hardware video port autoflipping capabilities, it also supports video bus masters, which can write data while in kernel mode. The bus master can be notified before losing the surface because of a mode change, or because a full-screen Command Prompt instance is launched. Because the new driver support allows a bus master to be called before the changes occur, the bus master can shut off without causing a problem. </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Kernel-Mode%20Video%20Transport"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
