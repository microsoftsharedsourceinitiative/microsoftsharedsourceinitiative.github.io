<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Printer Installation and the Plug and Play Manager</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="Printer Installation and the Plug and Play Manager">
</HEAD>
<BODY TOPMARGIN="0">
<DIV STYLE="display:none;">
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_plug_and_play_kg">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_introduction_to_plug_and_play_kg">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_device_installation_components_dg">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_controlflags_section_dr">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_device_id_dg_gly">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_hardware_id_dg_gly">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_compatible_id_dg_gly">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_devnode_dg_gly">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_hardware_id_dg_gly">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_compatible_id_dg_gly">
</OBJECT>
<OBJECT ID="hhobj_11" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_controlflags_section_dr">
</OBJECT>
</DIV>


<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Display&nbsp;and&nbsp;Print&nbsp;Devices:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H2><A NAME="ddk_printer_installation_and_the_plug_and_play_manager_gg"></A>Printer Installation and the Plug and Play Manager</H2>

<P>The Plug and Play manager handles all Plug and Play events for the machine, and is generic to all devices. The Plug and Play manager is documented in <A HREF="JavaScript:hhobj_1.Click()">Plug and Play</A>. <A HREF="JavaScript:hhobj_2.Click()">Introduction to Plug and Play</A> gives an overview of Plug and Play installation, and of how the various kernel-mode and user-mode components interact. </P>

<H4>Printer Installation Differences between Windows 98/Me and Windows 2000 and Later</H4>

<P>The Plug and Play architecture on Windows&nbsp;2000 and later differs from that on Windows&nbsp;95/98/Me. The most significant differences are:

<UL>
	<LI>The drivers included with Windows&nbsp;2000 and later are contained in a file, <I>driver.cab</I>, that is installed when the operating system is installed. This file contains all of the Plug and Play in-box drivers for all types of devices, so the user normally does not need the original installation media to install a driver.</LI>

	<LI>Little or no user intervention is required to install a particular driver. If a Windows&nbsp;2000 or later driver that is digitally signed by Microsoft is in <I>driver.cab</I> or already installed on the machine, Plug and Play verifies the driver's signature and installs the driver with no user intervention. This type of installation is called server-side installation. If the driver is not available on the system, or it is not signed, or the driver installation requires interaction with the user (through user interface elements), Plug and Play reverts to a client-side installation. For more information about each type of installation, see the discussion of the user-mode PnP manager in <A HREF="JavaScript:hhobj_3.Click()">Device Installation Components</A>. In most cases, when a machine is booted with a new Plug and Play device connected to it, the device is installed and ready to use by the time the user logs on.</LI>
</UL>

<P>If the user must be able to choose which driver to install, you can use an <B>InteractiveInstall</B> directive in the <A HREF="JavaScript:hhobj_4.Click()">INF <B>ControlFlags</B> section</A>. This directive can be used only in the following two circumstances:

<OL>
	<LI>To install devices that have incorrectly defined hardware IDs. This can occur when a hardware device has a corrupted hardware ID, or when a hardware vendor assigns the same hardware ID to two different devices, which is an error in hardware design. </LI>

	<LI>To install a driver for a device that cannot use the generic class installer or a driver supplied with the operating system.</LI>
</OL>

<P>If hardware IDs or compatible IDs are listed with the <B>InteractiveInstall</B> directive, Setup defers installation of printers matching those IDs to the client side, so the installation is delayed until an administrator logs on. The administrator is prompted to install the correct driver files. This is useful if two printer drivers share the same <A HREF="JavaScript:hhobj_5.Click()">device ID</A>, but require different drivers.</P>

<P>In contrast to Windows&nbsp;2000 and later, Windows&nbsp;95/98/Me Plug and Play installs devices without user intervention only if there is a <A HREF="JavaScript:hhobj_6.Click()">hardware ID</A> (rank-0) match. When there is a <A HREF="JavaScript:hhobj_7.Click()">compatible ID</A> (rank-1) match for the driver of a Plug and Play device, but no hardware ID match, the user is prompted to select the correct driver from the installation media. (This means that the user must have the installation media in order to install the driver.)</P>

<P>Also on Windows&nbsp;95/98/Me, when a driver is written for multiple devices (or for similar devices on multiple buses), the user is always prompted for installation if only the compatible ID was listed, unless every possible hardware ID is listed with a duplicate driver entry in the INF file.</P>

<H4>Duplicate Installation Detection</H4>

<P>When Setup calls the printer class installer to install a printer, the class installer determines whether the printer has already been manually installed. It does this by looking for exact matches between the driver and port names of currently installed printers and those listed in the INF file. If the class installer finds an installed print queue whose driver and port names match these two parameters, it does not install a second print queue, but instead associates it with the <A HREF="JavaScript:hhobj_8.Click()">devnode</A> entry. This prevents creating a second print queue for the same device.</P>

<P>A number of popular printer models share the same hardware ID (the HP DeskJet series, for example). On Windows&nbsp;95/98/Me, if a user manually installs a DeskJet model that is subsequently detected by Plug and Play, a second print queue is installed if the user selects the appropriate driver. If the user does not select a driver, then he or she is prompted to do so every time the computer reboots.</P>

<P>Windows&nbsp;2000 and later avoids this behavior by listing all printers with both a <A HREF="JavaScript:hhobj_9.Click()">hardware ID</A> and <A HREF="JavaScript:hhobj_10.Click()">compatible ID</A> match. When multiple matches are found, the class installer checks to see whether there is already a print queue with the same hardware ID match. If there is, the Plug and Play manager does not install a second queue. If not, the hardware ID match is downgraded to a compatible ID match. If these hardware IDs are also listed in the <B>InteractiveInstall</B> entry (see <A HREF="JavaScript:hhobj_11.Click()">INF <B>ControlFlags</B> section</A>) of the INF file, the user is prompted to select a driver.</P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Printer%20Installation%20and%20the%20Plug%20and%20Play%20Manager"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
