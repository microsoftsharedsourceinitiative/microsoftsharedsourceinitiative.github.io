<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>PREfast Background</TITLE>
<META Name="InChm" Content="True">
<META name="rtfFileName" content="prefast.rtf">
<!--CSS_START-->
<SCRIPT SRC="../scripts/dtuelink.js"></SCRIPT>
<!--CSS_END--></HEAD>
<body topmargin=0 id="bodyID" class = "dtBODY">

<!--NONSCROLLING BANNER START-->
<div id="nsbanner">
<div id="bannerrow1">
<TABLE CLASS="bannerparthead" CELLSPACING=0>
<TR ID="hdr">
<TD CLASS="runninghead" nowrap>PREfast&nbsp;User&nbsp;Guide</TD>
<TD CLASS="product" nowrap>&nbsp;</TD>
</TR>
</TABLE>
</div>
<div id="TitleRow">
<H1 class="dtH1"><A NAME="vcgrfhowprefastworks"></A>PREfast Background</H1>
</div></div>
<!--NONSCROLLING BANNER END-->
<DIV id="nstext" valign="bottom">
<div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><!-- Topic Status -->
<P>PREfast uses your existing build structure and works by intercepting your native compiler. You specify PREfast at the command line and prepend it to your command and arguments.</P>

<PRE class="syntax"><B>prefast <I>build_command</I> <I>arguments</I></B></PRE>

<P>where:

<DL>
<DT><I>build_command</I></DT>

<DD>One of three recognized commands:

<UL type="disc">
	<LI><B>cl </B><I>cl-arguments</I>
<P>Compiles and runs PREfast on an individual file and prints the PREfast results textually. The rest of the line is passed as arguments:

<P><code class="ce">prefast cl /c test.c</code>.
</li>

	<LI><B>nmake</B> <I>nmake-arguments</I>
<P>Performs an nmake and runs PREfast on all compiled files and prints the PREfast results textually. The rest of line is passed as arguments:

<P><code class="ce">prefast nmake /f pfw_build.mak</code>.
</li>

	<LI><B>build </B><I>build-arguments</I>
<P>Performs an nmake and runs PREfast on all compiled files and prints the PREfast results textually. The rest of the line is passed as arguments:

<P><code class="ce">prefast build /cefZ</code>.
</li>
</UL>
</dd>

<DT><I>arguments</I></DT>

<DD>Command specific. For more information, see <A HREF="vcgrfprefastcommandreference.htm">Command Reference</A>.</dd>
</DL>

<H4 class="dtH4">Remarks</H4>

<P>Once PREfast is invoked, prefast.exe changes the environment settings and invokes the specified build command. The changes to the environment include prepending <code class="ce">%PREFAST_ROOT%scripts\interceptcl;</code> to PATH and BUILD_PATH.</P>

<P>The \interceptcl directory contains a modified cl.exe and cl386.exe that call the regular build compiler (cl.exe or cl386.exe from the rest of the path). The DDK compiler performs PREfast analysis.</P>

<P>Users commonly run PREfast over a section of code, view results, make fixes, and then run PREfast again. It is not recommended that you perform a batch PREfast run on an entire large code base. Instead, you should divide your build into smaller (10 MB or less) sections and run PREfast on each section.</P>

<H4 class="dtH4">Example</H4>

<P>PREfast provides several sample source files that contain examples of the types of defects PREfast currently reports. </P>

<BLOCKQUOTE class="dtBlock">
<B>Note</B>&nbsp;&nbsp;&nbsp;If a header is not found when building bounds-examples.cpp, try setting INCLUDE to &lt;DDK installation path&gt;\inc\crt.</BLOCKQUOTE>

<P class="labelproc"><B>To run the PREfast examples from the command line</B>

<OL type="1">
	<LI>Change to the examples directory under your PREfast installation directory:
<PRE class="code"><code class="ce">cd %PREFAST_ROOT%\examples</code></PRE>
</li>

	<LI>Build a single example file:
<PRE class="code"><code class="ce">prefast cl -c pft-example1.cpp</code></PRE>
</li>

	<LI>Build all the example files in the DDK build environment:
<PRE class="code"><code class="ce">prefast build -cZ</code></PRE>
</li>

	<LI>View the results:
<PRE class="code"><code class="ce">prefast view</code></PRE>
</li>

	<LI>Clean all the example outputs:
<PRE class="code"><code class="ce">build -0c</code></PRE>
</li>
</OL>

<H4 class="dtH4">See Also</H4>

<P><A HREF="vcgrfprefastreference.htm">PREfast Reference</A></P>
<!--Footer Start-->
<DIV CLASS="footer">
<br>
<HR><!--Copyright-->
<p><MSHelp:link keywords="vxmscCopyright" TABINDEX="0">&copy; Microsoft Corporation. All rights reserved.</MSHelp:link></p></div> <!--Closes the footer div-->
</div> <!--closes the topic content div-->
<!--FOOTER_END-->
</BODY>
</HTML>
