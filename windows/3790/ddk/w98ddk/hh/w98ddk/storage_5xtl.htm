<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>QueryVolumeRemoval</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT></HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Windows&nbsp;98/Me:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H3><A NAME="_pss_4499"></A>QueryVolumeRemoval</H3>

<PRE>QueryVolumeRemoval(
 unsigned int drive
 )
 </PRE>

<P>This service is called by the IOS to notify the IFS manager of the pending removal of a plug-and-play drive. This service should not be called by other VxDs directly. VxDs should interface with the IOS and let the IOS do the notification to the IFS manager. This service calls IOS_Requestor_Service with IRS_QUERY_VOLUME_LOCK, to obtain the bitmap of drive letters associated with the volume. The member IRS_q_v_l_designtr contains the logical drive number zero = A: etc. Next, QueryVolumeRemoval tests for any open file handles (except those handles opened as type FIND_CHANGE_NOTIFY) on any of the drive letters (in other words, partitions) associated with the volume.</P>

<P>This service is called in the following places:</P>

<P>ISP_Query_Remove<BR>
CONFIG_START (sets CR_NEED_RESTART if any open files on RMM volumes)<BR>
CONFIGMG_QueryRemoveSubtree

<DL>
<DT><I>drive</I> </DT>

<DD>Supplies the zero-based logical drive number of the new device. </DD>
</DL>

<UL>
	<LI>Returns zero if the query was successful. Returns a nonzero value if the query was failed. </LI>
</UL>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: QueryVolumeRemoval"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
