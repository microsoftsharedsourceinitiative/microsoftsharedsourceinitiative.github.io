<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Guidelines for Designing and Writing a Driver</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT></HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Windows&nbsp;98/Me:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H2><A NAME="_pss_4741"></A>Guidelines for Designing and Writing a Driver</H2>

<P>When designing and writing your device driver, follow these guidelines: 

<UL>
	<LI>Make every effort to make your device driver as small as possible; reserve system memory for applications. </LI>

	<LI>Use multiple, discardable code segments to help reduce the amount of driver code needed in memory at any given time. </LI>

	<LI>Use an automatic data segment only if necessary. </LI>

	<LI>Make resources discardable, and lock them in memory only when needed. </LI>

	<LI>Use the stack sparingly. Because device drivers use the stack of the application that initiated the call to the driver, there is no way for the driver to determine how much available space is on the stack. </LI>

	<LI>Check for NULL pointers to avoid a general protection fault from using an invalid selector. </LI>

	<LI>Check the segment limits when reading from or writing to allocated segments to avoid a general protection fault from attempting to access data beyond the end of a segment. </LI>

	<LI>Use the <B>__ahincr</B> constant when creating selectors for huge memory (allocated memory greater than 64 kilobytes). Other methods of selector arithmetic can create invalid selectors and cause general protection faults. </LI>

	<LI>Create code-segment aliases for any code to be executed from data segments. Attempting to call or jump to a data segment address generates a general protection fault. </LI>
</UL>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Guidelines%20for%20Designing%20and%20Writing%20a%20Driver"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
