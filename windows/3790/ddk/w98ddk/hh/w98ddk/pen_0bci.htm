<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Unloading the Pen Device Driver</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT></HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Windows&nbsp;98/Me:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H2><A NAME="_pss_3452"></A>Unloading the Pen Device Driver</H2>

<P>The device driver's unloading process should ideally comply with the Plug and Play specifications. The Unidriver's exit code currently consists of only the function <B>cVpenD_Device_Exit</B>, which forms a shell for the exit procedure. The virtual pen driver receives a Sys_Critical_Exit message when the system unloads it. In handling this message, the virtual pen driver should place the hardware in a stable state and free any resources it holds. </P>

<P>The unloading process for the pen driver is also quite simple and straight forward. When the system unloads the pen driver, it sends the following three messages in the given order: DRV_CLOSE, DRV_DISABLE, and DRV_FREE. In processing the DRV_DISABLE message, the pen driver calls the virtual driver so it can turn off interrupts. The pen driver should return DRV_SUCCESS for all three messages. </P>

<P>As part of unloading the driver, the system sends a DRV_RemoveEntryPoints message so the system will receive no more pen packets. </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Unloading%20the%20Pen%20Device%20Driver"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
