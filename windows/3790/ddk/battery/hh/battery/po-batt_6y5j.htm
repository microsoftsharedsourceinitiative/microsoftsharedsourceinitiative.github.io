<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>Installing a Battery Driver</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="Installing a Battery Driver">
</HEAD>
<BODY TOPMARGIN="0">
<DIV STYLE="display:none;">
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_creating_an_inf_file_dg">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_file_sections_and_directives_dr">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_version_section_dr">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_strings_section_dr">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_destinationdirs_section_dr">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_manufacturer_section_dr">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_models_section_dr">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_ddinstall_section_dr">
</OBJECT>
<OBJECT ID="hhobj_9" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_copyfiles_directive_dr">
</OBJECT>
<OBJECT ID="hhobj_10" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_ddinstall.services_section_dr">
</OBJECT>
<OBJECT ID="hhobj_11" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_inf_addservice_directive_dr">
</OBJECT>
</DIV>


<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Battery&nbsp;Devices:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="ddk_installing_a_battery_driver_dg"></A>Installing a Battery Driver</H1>

<P>A battery driver's INF file specifies information about the driver and the devices it controls. All battery devices are members of the Battery class and the battery class installer installs the driver. </P>

<P>This section describes battery-specific entries in the INF file. For more information on creating and distributing INF files and installing drivers, see <A HREF="JavaScript:hhobj_1.Click()">Creating an INF File</A> and <A HREF="JavaScript:hhobj_2.Click()">INF File Sections and Directives</A>.  </P>

<P>A battery driver's INF file includes the sections described below. </P>

<H4>Version</H4>

<P>A battery driver's INF file specifies the Battery class and its GUID, using the <A HREF="JavaScript:hhobj_3.Click()">INF <B>Version</B> section</A>, as shown in the following example:</P>

<PRE>[Version]
Signature="$WINDOWS NT$"
Class=Battery
ClassGuid={72631e54-78a4-11d0-bcf7-00aa00b7b32a}
Provider=%MyCo%</PRE>

<P>Note that %MyCo% must be defined in an <A HREF="JavaScript:hhobj_4.Click()">INF <B>Strings</B> section</A> (not shown). </P>

<H4>DestinationDirs</H4>

<P>In the <A HREF="JavaScript:hhobj_5.Click()">INF <B>DestinationDirs</B> section</A>, a battery driver's INF specifies the Drivers directory (12) as the default for all files. </P>

<PRE>[DestinationDirs]
DefaultDestDir = 12</PRE>

<H4>Manufacturer</H4>

<P>The <A HREF="JavaScript:hhobj_6.Click()">INF <B>Manufacturer</B> section</A> defines the manufacturer of the device.</P>

<PRE>[Manufacturer]
%MyCo%=MyCompany</PRE>

<H4>Models</H4>

<P>The <A HREF="JavaScript:hhobj_7.Click()">INF <I>Models</I> section</A> specifies the PnP hardware ID of the battery (shown as <I>pnpid</I> in the example). If the device is enumerated through ACPI, this section must also specify the EISA-style ID (shown as <I>acpidevnum</I>). For information on creating these IDs, see the <I>Advanced Configuration and Power Management Interface Specification</I>, which is available through the <a href="http://go.microsoft.com/fwlink/?linkid=8760&clcid=0x409" target="_blank">ACPI / Power Management</A> Web site.</P>

<PRE>[MyCompany]
%<I>pnpid</I>.DeviceDesc% = NewBatt_Inst,<I>pnpid</I>
%ACPI\<I>acpidevnum</I>.DeviceDesc% = NewBatt_Inst,ACPI\<I>acpidevnum</I></PRE>

<H4>DDInstall</H4>

<P>In the <A HREF="JavaScript:hhobj_8.Click()">INF <I>DDInstall</I> section</A> (named NewBatt_Inst in the example), an <A HREF="JavaScript:hhobj_9.Click()">INF <B>CopyFiles</B> directive</A> copies the battery class driver (<I>Battc.sys</I>) and the new miniclass driver (<I>NewBatt.sys</I>) to the destination specified in the <B>DestinationDirs</B> directive.</P>

<PRE>[NewBatt_Inst]
CopyFiles = @NewBatt.sys
CopyFiles = @battc.sys</PRE>

<H4>DDInstall.Services</H4>

<P>The <A HREF="JavaScript:hhobj_10.Click()">INF <I>DDInstall</I><B>.Services</B> section</A> includes an <A HREF="JavaScript:hhobj_11.Click()">INF <B>AddService</B> directive</A> that specifies additional information about the battery driver. A battery driver's INF file should indicate that the driver is a kernel driver that uses normal error handling and starts during initialization of the operating system. Battery drivers specify the load order group Extended Base.</P>

<PRE>[NewBatt_Inst.Services]
AddService = NewBatt,2,NewBatt_Service_Inst    ; function driver for the device
 
[NewBatt_Service_Inst]
DisplayName    = %NewBatt.SvcDesc%
ServiceType    = 1 ;    SERVICE_KERNEL_DRIVER
StartType      = 3 ;    SERVICE_DEMAND_START
ErrorControl   = 1 ;    SERVICE_ERROR_NORMAL%
ServiceBinary  = %12%\NewBatt.sys</PRE>

<P></P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: Installing%20a%20Battery%20Driver"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
