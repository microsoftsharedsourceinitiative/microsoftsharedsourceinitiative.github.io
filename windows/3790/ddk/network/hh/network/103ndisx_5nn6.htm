<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>NdisMIndicateStatus</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="NdisMIndicateStatus">
</HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Network&nbsp;Devices&nbsp;and&nbsp;Protocols:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="ddk_ndismindicatestatus_nr"></A>NdisMIndicateStatus</H1>

<P><B>NdisMIndicateStatus</B> indicates changes in the status of a NIC to higher-level NDIS drivers. </P>

<PRE class=syntax><B>VOID 
  NdisMIndicateStatus(
    IN NDIS_HANDLE</B>  <I>MiniportAdapterHandle</I><B>,</B>
    <B>IN NDIS_STATUS</B>  <I>GeneralStatus</I><B>,</B>
    <B>IN PVOID</B>  <I>StatusBuffer</I><B>,</B>
    <B>IN UINT</B>  <I>StatusBufferSize
    </I><B>);</B></PRE>

<H4>Parameters</H4>

<DL>
<DT><I>MiniportAdapterHandle</I></DT>

<DD>Specifies the handle originally input to <A HREF="101mini_9jzm.htm"><I>MiniportInitialize</I></A>. </DD>

<DT><I>GeneralStatus</I></DT>

<DD>Specifies the NDIS_STATUS_<I>XXX</I> value that indicates the general change in status for the NIC. </DD>

<DT><I>StatusBuffer</I></DT>

<DD>Pointer to a caller-allocated buffer containing data that is medium-specific and dependent on the value of <I>GeneralStatus</I>. It indicates detailed information about the change in status. </DD>

<DT><I>StatusBufferSize</I></DT>

<DD>Specifies the size in bytes of the buffer at <I>StatusBuffer</I>.
</DD>
</DL>

<H4>Headers</H4>

<P>Declared in <I>Ndis.h</I>. Include <I>Ndis.h</I>.</P>

<H4>Comments</H4>

<P>When a miniport driver calls <B>NdisMIndicateStatus</B>, NDIS calls each bound protocol’s <A HREF="104tdlow_6e42.htm"><I>ProtocolStatus</I></A> function. This allows a bound protocol driver or, possibly, the configuration manager to log the change in status of an underlying NIC or to take corrective action. For example, a protocol might call <A HREF="103ndisx_9ib6.htm"><B>NdisReset</B></A>, depending on the NDIS_STATUS_<I>XXX</I> indicated. </P>

<P>When a miniport driver calls <B>NdisMIndicateStatus</B> to report a change in NIC status, NDIS can call the <A HREF="101mini_5hiq.htm"><I>MiniportReset</I></A> function to try restoring the NIC to a working condition. In these circumstances, NDIS can call bound protocols only with NDIS_STATUS_RESET_START and later with NDIS_STATUS_RESET_END, rather than with the <I>GeneralStatus</I> indicated by the miniport driver.</P>

<P><B>NdisMIndicateStatus</B> provides two pieces of information:

<UL>
	<LI>An overall status value indicating the general change in status.</LI>

	<LI>A specific reason for the general change, which can be network-specific. For example, ring-insertion failures are particular to Token Ring (802.5) networks, but are irrelevant to Ethernet (802.3) NICs and their drivers.</LI>
</UL>

<P>A miniport driver also can call <B>NdisMIndicateStatus</B> to indicate problems such as cables that have been accidentally removed and then reinserted, or a ring that has temporarily failed. For example, suppose both the following conditions occur: 

<UL>
	<LI>The miniport driver calls <B>NdisMIndicateStatus</B> with NDIS_STATUS_RING_STATUS.</LI>

	<LI>The <I>StatusBuffer</I> contains one of the following status values:
<UL>
	<LI>NDIS_RING_LOBE_WIRE_FAULT</LI>

	<LI>NDIS_RING_HARD_ERROR</LI>

	<LI>NDIS_RING_SIGNAL_LOSS</LI>
</UL>
</LI>
</UL>

<P>After such a change in status has been signaled with an indication, any associated thresholds or statistics counters remain unchanged.</P>

<P>A miniport driver cannot call <B>NdisMIndicateStatus</B> in the context of its <A HREF="101mini_9jzm.htm"><I>MiniportInitialize</I></A>, <A HREF="101mini_38c2.htm"><I>MiniportISR</I></A>, <A HREF="101mini_6stu.htm"><I>MiniportHalt</I></A>, or <A HREF="101mini_7lo2.htm"><I>MiniportShutdown</I></A> function.</P>

<P>Serialized callers of <B>NdisMIndicateStatus</B> run at IRQL = DISPATCH_LEVEL. Deserialized callers of <B>NdisMIndicateStatus</B> can run at IRQL &lt;= DISPATCH_LEVEL.</P>

<H4>Indicating the Loss and Restoration of a Network Connection</H4>

<P>When a miniport driver senses that the network connection has been lost, it should call <B>NdisMIndicateStatus</B> with NDIS_STATUS_MEDIA_DISCONNECT. When the connection is restored, the miniport driver should call <B>NdisMIndicateStatus</B> with NDIS_STATUS_MEDIA_CONNECT.</P>

<H4>WAN Miniport Driver Calls to NdisMIndicateStatus</H4>

<P>Most WAN NIC drivers indicate status with some special status codes and buffer contents. These status indications are generated by WAN NIC drivers, and NDIS protocol drivers bound to such a miniport driver can ignore these indications. However, processing these indications correctly usually results in improved performance for protocols and for WAN NIC drivers. </P>

<P>The following four types of WAN-specific indications can be sent to bound protocol drivers with <B>NdisMIndicateStatus</B>: 

<UL>
	<LI>Line up</LI>

	<LI>Line down</LI>

	<LI>Fragment</LI>

	<LI>TAPI line event</LI>
</UL>

<H4>NDIS_STATUS_WAN_LINE_UP</H4>

<P>A WAN miniport driver makes a line-up indication whenever a new link becomes active. Until this occurs, the NIC will accept frames and let them succeed or fail, but it is unlikely that they will actually be received by any remote node. Until this occurs, protocols should reduce their timers and retry counts so as to quickly fail any outgoing connection attempts.</P>

<P>The WAN miniport driver makes this indication with <B>NdisMIndicateStatus</B> before it returns from the <A HREF="29tpioid_5rsi.htm">OID_TAPI_GET_ID</A> request. </P>

<P>The status code for the line-up indication is NDIS_STATUS_WAN_LINE_UP. The buffer at <I>StatusBuffer</I> is formatted as an <A HREF="105nstru_4agi.htm">NDIS_MAC_LINE_UP</A> structure.</P>

<H4>NDIS_STATUS_WAN_LINE_DOWN</H4>

<P>A WAN miniport driver makes a line-down indication whenever a link goes down. When this occurs, bound protocols should reduce their timers and retry counts until the next line-up indication.</P>

<P>The status code for the line-down indication is NDIS_STATUS_WAN_LINE_DOWN. The buffer at <I>StatusBuffer</I> is formatted as an <A HREF="105nstru_1q7m.htm">NDIS_MAC_LINE_DOWN</A> structure.</P>

<H4>NDIS_STATUS_WAN_FRAGMENT</H4>

<P>A WAN miniport driver makes a fragment indication whenever it receives a partial packet from the remote node. When this occurs, a bound protocol should send frames to the remote that will notify it of this situation, rather than waiting for a time-out to occur.</P>

<P>The status code for the fragment indication is NDIS_STATUS_WAN_FRAGMENT. The buffer at <I>StatusBuffer</I> is formatted as an <A HREF="105nstru_7v5e.htm">NDIS_MAC_FRAGMENT</A> structure. </P>

<P>NDISWAN monitors dropped packets by counting the number of fragment indications on each link.</P>

<H4>NDIS_TAPI_EVENT</H4>

<P>A WAN miniport driver must use a <I>GeneralStatus</I> value of NDIS_STATUS_TAPI_INDICATION for TAPI status indications<I>.</I> The buffer at <I>StatusBuffer</I> is formatted as an NDIS_TAPI_EVENT structure. </P>

<H4>See Also</H4>

<P><A HREF="101mini_9jzm.htm"><I>MiniportInitialize</I></A>, <A HREF="101mini_5hiq.htm"><I>MiniportReset</I></A>, <A HREF="105nstru_7v5e.htm">NDIS_MAC_FRAGMENT</A>, <A HREF="105nstru_1q7m.htm">NDIS_MAC_LINE_DOWN</A>, <A HREF="105nstru_4agi.htm">NDIS_MAC_LINE_UP</A>, <A HREF="103ndisx_62ur.htm"><B>NdisMIndicateStatusComplete</B></A>, <A HREF="105nstru_43jm.htm">NDIS_TAPI_EVENT</A>, <A HREF="104tdlow_6e42.htm"><I>ProtocolStatus</I></A> </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: NdisMIndicateStatus"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
